(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7693],{77693:function(e,t,i){var n=i(21876).Buffer,r=i(11987),a=i(931),s=(i(51027),{ms:1,second:1e3,minute:6e4,hour:36e5,day:864e5,week:6048e5,month:2592e6}),c=[],o=function(e){return function(t){return!function(e){return function(t){return e===t}}(e)(t)}},h=function(e,t){return"\x1b[33m- "+(t?t+" ":"")+(e>1e3?(e/1e3).toFixed(2)+"sec":e+"ms")+"\x1b[0m"};function u(e){return e.getHeaders?e.getHeaders():e._headers}e.exports=new function e(){var t=new a,i={debug:!1,defaultDuration:36e5,enabled:!0,appendKey:[],jsonp:!1,redisClient:!1,headerBlacklist:[],statusCodes:{include:[],exclude:[]},events:{expire:void 0},headers:{},trackPerformance:!1},l=[],p=this,d=null,f={},g=[];function m(e,t,n,r){var a=["\x1b[36m[apicache]\x1b[0m",e,t,n,r].filter((function(e){return void 0!==e})),s={NODE_ENV:"production",npm_package_version:"5.200.1",ASSET_PREFIX:"/",DFP_AD_UNIT:"undefined",DISABLE_REDUX_LOGGING:"undefined"}.DEBUG&&-1!=={NODE_ENV:"production",npm_package_version:"5.200.1",ASSET_PREFIX:"/",DFP_AD_UNIT:"undefined",DISABLE_REDUX_LOGGING:"undefined"}.DEBUG.split(",").indexOf("apicache");return(i.debug||s)&&console.log.apply(null,a)}function y(e,t,n){var r=i.statusCodes;return!!t&&(!(n&&!n(e,t))&&((!r.exclude||!r.exclude.length||-1===r.exclude.indexOf(t.statusCode))&&(!r.include||!r.include.length||-1!==r.include.indexOf(t.statusCode))))}function v(e,t){var i=t.apicacheGroup;i&&(m('group detected "'+i+'"'),(d.groups[i]=d.groups[i]||[]).unshift(e));d.all.unshift(e)}function w(e){return Object.keys(e).filter((function(e){return-1===i.headerBlacklist.indexOf(e)})).reduce((function(t,i){return t[i]=e[i],t}),{})}function _(e,t,i,n){return{status:e,headers:w(t),data:i,encoding:n,timestamp:(new Date).getTime()/1e3}}function C(e,n,r){var a=i.redisClient,s=i.events.expire;if(a&&a.connected)try{a.hset(e,"response",JSON.stringify(n)),a.hset(e,"duration",r),a.expire(e,r/1e3,s||function(){})}catch(c){m("[apicache] error in redis.hset()")}else t.add(e,n,r,s);f[e]=setTimeout((function(){p.clear(e,!0)}),Math.min(r,2147483647))}function x(e,t){if(t)if("string"==typeof t)e._apicache.content=(e._apicache.content||"")+t;else if(n.isBuffer(t)){var i=e._apicache.content;"string"===typeof i&&(i=n.from?n.from(i):new n(i)),i||(i=n.alloc?n.alloc(0):new n(0)),e._apicache.content=n.concat([i,t],i.length+t.length)}else e._apicache.content=t}function k(e,t,n,r,a,s,c){t._apicache={write:t.write,writeHead:t.writeHead,end:t.end,cacheable:!0,content:void 0},Object.keys(i.headers).forEach((function(e){t.setHeader(e,i.headers[e])})),t.writeHead=function(){return i.headers["cache-control"]||(y(e,t,c)?t.setHeader("cache-control","max-age="+(a/1e3).toFixed(0)):t.setHeader("cache-control","no-cache, no-store, must-revalidate")),t._apicache.headers=Object.assign({},u(t)),t._apicache.writeHead.apply(this,arguments)},t.write=function(e){return x(t,e),t._apicache.write.apply(this,arguments)},t.end=function(i,n){if(y(e,t,c)&&(x(t,i),t._apicache.cacheable&&t._apicache.content)){v(r,e);var o=t._apicache.headers||u(t),l=_(t.statusCode,o,t._apicache.content,n);C(r,l,a);var p=new Date-e.apicacheTimer;m('adding cache entry for "'+r+'" @ '+s,h(p)),m("_apicache.headers: ",t._apicache.headers),m("res.getHeaders(): ",u(t)),m("cacheObject: ",l)}return t._apicache.end.apply(this,arguments)},n()}function b(e,t,i,r,a,s){if(r&&!r(e,t))return a();var c=u(t);Object.assign(c,w(i.headers||{}),{"cache-control":"max-age="+Math.max(0,(s/1e3-((new Date).getTime()/1e3-i.timestamp)).toFixed(0))});var o=i.data;o&&"Buffer"===o.type&&(o="number"===typeof o.data?new n.alloc(o.data):new n.from(o.data));var h=i.headers.etag,l=e.headers["if-none-match"];return l&&h===l?(t.writeHead(304,c),t.end()):(t.writeHead(i.status||200,c),t.end(o,i.encoding))}function D(){for(var e in l)Object.assign(l[e].options,i,l[e].localOptions)}function O(e,t){if("number"===typeof e)return e;if("string"===typeof e){var i=e.match(/^([\d\.,]+)\s?(\w+)$/);if(3===i.length){var n=parseFloat(i[1]),r=i[2].replace(/s$/i,"").toLowerCase();return"m"===r&&(r="ms"),(n||1)*(s[r]||0)}}return t}c.push(this),this.id=c.length,this.clear=function(e,n){var r=d.groups[e],a=i.redisClient;if(r)m('clearing group "'+e+'"'),r.forEach((function(e){if(m('clearing cached entry for "'+e+'"'),clearTimeout(f[e]),delete f[e],i.redisClient)try{a.del(e)}catch(n){console.log('[apicache] error in redis.del("'+e+'")')}else t.delete(e);d.all=d.all.filter(o(e))})),delete d.groups[e];else if(e){if(m("clearing "+(n?"expired":"cached")+' entry for "'+e+'"'),clearTimeout(f[e]),delete f[e],a)try{a.del(e)}catch(s){console.log('[apicache] error in redis.del("'+e+'")')}else t.delete(e);d.all=d.all.filter(o(e)),Object.keys(d.groups).forEach((function(t){d.groups[t]=d.groups[t].filter(o(e)),d.groups[t].length||delete d.groups[t]}))}else m("clearing entire index"),a?d.all.forEach((function(e){clearTimeout(f[e]),delete f[e];try{a.del(e)}catch(s){console.log('[apicache] error in redis.del("'+e+'")')}})):t.clear(),this.resetIndex();return this.getIndex()},this.getDuration=function(e){return O(e,i.defaultDuration)},this.getPerformance=function(){return g.map((function(e){return e.report()}))},this.getIndex=function(e){return e?d.groups[e]:d},this.middleware=function(e,n,a){var s=p.getDuration(e),c={};l.push({options:c});var o=function(e){return e&&(l.find((function(e){return e.options===c})).localOptions=e),D(),c};o(a);var u=i.trackPerformance?new function(){this.hitsLast100=new Uint8Array(25),this.hitsLast1000=new Uint8Array(250),this.hitsLast10000=new Uint8Array(2500),this.hitsLast100000=new Uint8Array(25e3),this.callCount=0,this.hitCount=0,this.lastCacheHit=null,this.lastCacheMiss=null,this.report=function(){return{lastCacheHit:this.lastCacheHit,lastCacheMiss:this.lastCacheMiss,callCount:this.callCount,hitCount:this.hitCount,missCount:this.callCount-this.hitCount,hitRate:0==this.callCount?null:this.hitCount/this.callCount,hitRateLast100:this.hitRate(this.hitsLast100),hitRateLast1000:this.hitRate(this.hitsLast1000),hitRateLast10000:this.hitRate(this.hitsLast10000),hitRateLast100000:this.hitRate(this.hitsLast100000)}},this.hitRate=function(e){for(var t=0,i=0,n=0;n<e.length;n++){var r=e[n];for(j=0;j<4;j++){switch(3&r){case 1:t++;break;case 2:i++}r>>=2}}var a=t+i;return 0==a?null:t/a},this.recordHitInArray=function(e,t){var i=~~(this.callCount/4)%e.length,n=this.callCount%4*2,r=~(3<<n),a=(t?1:2)<<n;e[i]=e[i]&r|a},this.recordHit=function(e){this.recordHitInArray(this.hitsLast100,e),this.recordHitInArray(this.hitsLast1000,e),this.recordHitInArray(this.hitsLast10000,e),this.recordHitInArray(this.hitsLast100000,e),e&&this.hitCount++,this.callCount++},this.hit=function(e){this.recordHit(!0),this.lastCacheHit=e},this.miss=function(e){this.recordHit(!1),this.lastCacheMiss=e}}:new function(){this.report=this.hit=this.miss=function(){}};g.push(u);var d=function(i,a,o){function l(){return m("bypass detected, skipping cache."),o()}if(!c.enabled)return l();if(i.headers["x-apicache-bypass"]||i.headers["x-apicache-force-fetch"])return l();i.apicacheTimer=new Date;var p=i.originalUrl||i.url;if(c.jsonp&&(p=r.parse(p).pathname),"function"===typeof c.appendKey)p+="$$appendKey="+c.appendKey(i,a);else if(c.appendKey.length>0){for(var d=i,f=0;f<c.appendKey.length;f++)d=d[c.appendKey[f]];p+="$$appendKey="+d}var g=c.redisClient,y=g?null:t.getValue(p);if(y){var v=new Date-i.apicacheTimer;return m("sending cached (memory-cache) version of",p,h(v)),u.hit(p),b(i,a,y,n,o,s)}if(!g||!g.connected)return u.miss(p),k(i,a,o,p,s,e,n);try{g.hgetall(p,(function(t,r){if(!t&&r&&r.response){var c=new Date-i.apicacheTimer;return m("sending cached (redis) version of",p,h(c)),u.hit(p),b(i,a,JSON.parse(r.response),n,o,s)}return u.miss(p),k(i,a,o,p,s,e,n)}))}catch(w){return u.miss(p),k(i,a,o,p,s,e,n)}};return d.options=o,d},this.options=function(e){return e?(Object.assign(i,e),D(),"defaultDuration"in e&&(i.defaultDuration=O(i.defaultDuration,36e5)),i.trackPerformance&&m("WARNING: using trackPerformance flag can cause high memory usage!"),this):i},this.resetIndex=function(){d={all:[],groups:{}}},this.newInstance=function(t){var i=new e;return t&&i.options(t),i},this.clone=function(){return this.newInstance(this.options())},this.resetIndex()}},931:function(e){function t(){this.cache={},this.size=0}t.prototype.add=function(e,t,i,n){this.cache[e];var r=this,a={value:t,expire:i+Date.now(),timeout:setTimeout((function(){return r.delete(e),n&&"function"===typeof n&&n(t,e)}),i)};return this.cache[e]=a,this.size=Object.keys(this.cache).length,a},t.prototype.delete=function(e){var t=this.cache[e];return t&&clearTimeout(t.timeout),delete this.cache[e],this.size=Object.keys(this.cache).length,null},t.prototype.get=function(e){return this.cache[e]},t.prototype.getValue=function(e){var t=this.get(e);return t&&t.value},t.prototype.clear=function(){return Object.keys(this.cache).forEach((function(e){this.delete(e)}),this),!0},e.exports=t},51027:function(e){"use strict";e.exports=JSON.parse('{"_args":[["apicache@1.5.3","/app"]],"_from":"apicache@1.5.3","_id":"apicache@1.5.3","_inBundle":false,"_integrity":"sha512-n1h39Bt7tMiJMV0u0tFlhigig8Uo/wJmKoj6WE/OwvZ+WbFchn7jnXleotZOzZTUBtr0Tg9iJshHnJDAGQbAEQ==","_location":"/apicache","_phantomChildren":{},"_requested":{"type":"version","registry":true,"raw":"apicache@1.5.3","name":"apicache","escapedName":"apicache","rawSpec":"1.5.3","saveSpec":null,"fetchSpec":"1.5.3"},"_requiredBy":["/"],"_resolved":"https://nexus.nbcnewstools.net/repository/NBCNewsNPMGroup/apicache/-/apicache-1.5.3.tgz","_spec":"1.5.3","_where":"/app","author":{"name":"Kevin R. Whitley","email":"krwhitley@gmail.com","url":"http://krwhitley.com"},"bugs":{"url":"https://github.com/kwhitley/apicache/issues","email":"krwhitley@gmail.com"},"dependencies":{},"description":"An ultra-simplified API response caching middleware for Express/Node using plain-english durations.","devDependencies":{"chai":"^4.2.0","compression":"^1.7.4","coveralls":"^3.0.6","eslint":"^4.18.0","express":"^4.17.1","fakeredis":"^2.0.0","husky":"^3.0.4","mocha":"^7.0.0","nyc":"^13.3.0","prettier":"^1.18.2","pretty-quick":"^1.11.1","restify":"^7.7.0","restify-etag-cache":"^1.0.12","supertest":"^4.0.2"},"engines":{"node":">=6.2.0 <13"},"homepage":"https://github.com/kwhitley/apicache#readme","husky":{"hooks":{"pre-commit":"pretty-quick --staged && npm run test"}},"keywords":["cache","API","redis","memcache","response","express","JSON","duration","middleware","memory"],"license":"MIT","main":"./src/apicache.js","name":"apicache","repository":{"type":"git","url":"git+https://github.com/kwhitley/apicache.git"},"scripts":{"coverage":"nyc report --reporter=text-lcov | coveralls","lint":"eslint .","prepublish":"npm run test","pretest":"npm run lint","test":"nyc mocha $(find test -name \'*.test.js\') --recursive","test:watch":"npm run test -- --watch"},"version":"1.5.3"}')}}]);