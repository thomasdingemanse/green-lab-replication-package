(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-n-feedback"],{"1ea81dd9":function(e,t,n){let o=n("15baad73");o=o.default||o;const a=n("32871998"),s=n("84f1eb7e"),c=n("fa7eec55"),r=n("81b4d3e9");function d(e){return fetch("https://www.ft.com/__feedback-api/v1/survey/"+e,{headers:{Accept:"application/json"}}).then(e=>(200!==e.status&&e.text().then(e=>{throw new Error(`Bad response status ${status}: ${e}`)}),e.json()))}function i(e,t,n,o){const a=e.content,{containerSelector:r="body"}=o;document.querySelectorAll(".n-feedback__survey-next,.n-feedback__survey-back",a).forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();const n="."+t.target.getAttribute("data-survey-next");u(e,n)},!0)});const d=document.querySelector(".n-feedback__survey__wrapper-form",a);d&&d.addEventListener("submit",a=>{a.preventDefault();const d=function(e){const t=e.content,n=document.querySelector(".n-feedback__survey__wrapper-form",t),o={};return n.querySelectorAll("input,textarea").forEach(e=>{"radio"===e.type?e.checked&&(o[e.name]=e.value):"checkbox"===e.type?e.checked&&(o[e.name]=(o[e.name]||[]).concat(e.value)):o[e.name]=e.value}),o}(e),i=c(o);u(e,".feedback-overlay__loader-wrapper"),s(n,t,d,i).then(()=>{u(e,".n-feedback__survey-block-finished"),e.wrapper.addEventListener("oOverlay.destroy",()=>{!function(e){document.querySelector(e+" .n-feedback__container").classList.add("n-feedback--hidden")}(r)})}).catch(t=>{console.error("Failed to post form",t),e.close()})}),a&&a.addEventListener("change",e=>{l(e.target.closest(".n-feedback__survey-block"))})}function u(e,t){const n=e.content,o=document.querySelector(t,n),a=document.querySelectorAll(".n-feedback__survey-block",n);l(o),a.forEach(e=>e.classList.add("n-feedback--hidden")),o.classList.remove("n-feedback--hidden")}function l(e){const t=document.querySelector(".n-feedback__survey-next",e);return function(e){const t=document.querySelectorAll('[data-validation="true"]',e);return 0===Array.prototype.slice.call(t).filter(e=>{if(e.classList.contains("n-feedback__question-radio")){const t=document.querySelectorAll('input[type="radio"]',e);return 0===Array.prototype.slice.call(t).filter(e=>e.checked).length}}).length}(e)?(t.removeAttribute("disabled"),!0):(t.setAttribute("disabled","disabled"),!1)}function f(e){e[e.visible?"close":"open"]()}function b(e,t){const n=r[t].formHead;e.innerHTML=`<div class="n-feedback__overlay__container"></div>\n\t\t<p class="n-feedback__desktop__prompt">\n\t\t\t${n}\n\t\t</p>\n\t\t<button class="n-feedback__survey-trigger" aria-label="Give feedback on the Financial Times website" data-trackable="feedback-start">\n\t\t\t<span>Feedback</span>\n\t\t</button>`}const _=e=>(e.domain||(e.domain="FT.com"),e.containerSelector||(e.containerSelector="body"),e);e.exports.init=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t="SV_9mBFdO5zpERO0cZ",{containerSelector:n,domain:s}=_(e);let c,r;const u=document.querySelector(n+" .n-feedback__container");u.classList.remove("n-feedback--hidden"),b(u,s);const p=document.querySelector(n+" .n-feedback__container .n-feedback__survey-trigger"),v="feedback-overlay-"+n;return p&&p.addEventListener("click",()=>{r||(r=new o(v,{html:'<div class="feedback-overlay__loader-wrapper"><div class="o-loading o-loading--dark o-loading--large"></div></div>',fullscreen:!0,class:"feedback-overlay",zindex:1001,customclose:".n-feedback__survey__close-button"})),c||d(t).then(n=>{if(!n||n&&0===n.length)console.error("Bad survey data");else{c=n;const o=a.buildSurvey(c,t,s);r.visible||r.open(),r.content.innerHTML=o,i(r,c,t,e);l(document.querySelectorAll(".n-feedback__survey-block",r.content)[0])}}).catch(e=>{r.destroy(),u.classList.add("n-feedback--hidden"),p.classList.add("n-feedback--hidden"),console.error("Failed to get survey data",e)}),f(r)},!0),{destroy:()=>{r&&r.destroy()}}}},32871998:function(e,t,n){const o=n("81b4d3e9");function a(e){return`<div class="n-feedback__center-block"><h2 class="n-feedback__question-header">${e.questionText}</h2></div>`}function s(e){return`<p class="n-feedback__question-text">${e.questionText}</p>`}function c(e){return`<div class="n-feedback__center-block"><p class="n-feedback__question-footer">${e.questionText}</p></div>`}function r(e){const t={MC:d,TE:i},n=e.questionType.type;return n in t?t[n](e):""}function d(e){const t=[`<fieldset class="n-feedback__question-radio" data-validation=${e.validation.doesForceResponse}>\n\t\t\t<legend>${e.questionText}</legend>\n\t\t\t<div class="n-feedback__center-block">\n\t\t\t<div class="o-forms-field">\n\t\t\t`];return Object.entries(e.choices).reverse().forEach(n=>{let[o,a]=n;const s=`choice-${o}-${~~(65535*Math.random())}`;t.push(`\n\t\t\t<div class="o-forms-input o-forms-input--radio-round">\n\t\t\t\t<input type="radio" id="${s}" name="${e.questionId}" value="${o}" />\n\t\t\t\t<label for="${s}" class="o-forms-input__label">\n\t\t\t\t\t${a.choiceText}\n\t\t\t\t</label>\n\t\t\t</div>\n\t\t\t`)}),t.push("</div></div></fieldset>"),t.join("\n")}function i(e){const t=`text-${e.questionId}-${~~(65535*Math.random())}`;return`<div class="n-feedback__center-block">\n\t\t\t<div class="n-feedback__question-text-entry o-forms">\n\t\t\t\t<div class="o-forms-field">\n\t\t\t\t\t<label for="${t}" class="o-forms-label">\n\t\t\t\t\t\t<span class="o-forms-title">\n\t\t\t\t\t\t\t<span class="o-forms-title__main">${e.questionText}</span>\n\t\t\t\t\t\t</span>\n\t\t\t\t\t\t<div class="o-forms-input o-forms-input--textarea">\n\t\t\t\t\t\t\t<textarea id="${t}" name="${e.questionId}" rows="8"></textarea>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</label>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</div>\n\t\t`}e.exports={buildSurvey:function(e,t,n){const d={header:a,footer:c,text:s,question:r},i=[`<div class="n-feedback__survey" aria-live="assertive">\n\t\t\t<a class="n-feedback__survey__close-button o-overlay__close" href="#void">\n\t\t\t\t<span>I don't want to give feedback</span>\n\t\t\t</a>\n\t\t\t<form class="n-feedback__survey__wrapper-form">\n\t\t\t\t<input type="hidden" name="surveyId" value="${t}" />`];e.forEach((t,a)=>{const s=[`<div class="n-feedback__survey-block ${0===a?"":"n-feedback--hidden"} n-feedback__survey-block-${a}">`];t.questions.forEach(e=>{"How easy or hard was it to use FT.com today?"===e.questionText.trim()&&"app"===n&&(e.questionText=o[n].formHead);const t=e.questionName.toLowerCase();if(t in d){const n=d[t](e);s.push(n)}}),s.push(function(e,t){const n=[];return n.push('<div class="n-feedback__center-block"><p class="n-feedback__survey__button-bar">'),t>0&&n.push(`<button class="n-feedback__primary-button n-feedback__survey-back"\n\t\t\t\tdata-survey-next="n-feedback__survey-block-${t-1}"\n\t\t\t\tdata-trackable="feedback-previous-block">\n\t\t\t\tBack\n\t\t\t</button>`),e-1>t?n.push(`<button class="n-feedback__primary-button n-feedback__survey-next"\n\t\t\t\tdata-survey-next="n-feedback__survey-block-${t+1}"\n\t\t\t\tdata-trackable="feedback-next-block">\n\t\t\t\tNext\n\t\t\t</button>`):n.push('<button class="n-feedback__primary-button n-feedback__survey-submit"\n\t\t\t\tdata-trackable="feedback-submit">\n\t\t\t\tSubmit\n\t\t\t</button>'),n.push("</p></div>"),n.join("\n")}(e.length,a)),s.push("</div>"),i.push(s.join("\n"))}),i.push("</form>"),i.push('<div class="n-feedback__survey-block feedback-overlay__loader-wrapper n-feedback--hidden"><div class="o-loading o-loading--dark o-loading--large"></div></div>');const u=e.map(e=>e.questions.find(e=>"Text"===e.questionName))[0];return i.push(`<div class="n-feedback__survey-block n-feedback--hidden n-feedback__survey-block-finished">\n\t\t\t${a({questionText:"Thanks for your feedback"})}\n\n\t\t\t${u?c(u):""}\n\n\t\t\t<div class="n-feedback__center-block"><p class="n-feedback__survey__button-bar">\n\t\t\t\t<button class="n-feedback__primary-button o-overlay__close">\n\t\t\t\t\tClose\n\t\t\t\t</button>\n\t\t</div>`),i.push("</div>"),i.join("\n")}}},"81b4d3e9":function(e,t){e.exports={app:{formHead:"How easy or hard was it to use the FT app today?"},"FT.com":{formHead:"How easy or hard was it to use FT.com today?"}}},"84f1eb7e":function(e,t,n){const o=n("e4095750");e.exports=function(e,t,n,a){const s={surveyId:e,surveyResponse:o(t).map(e=>{const{id:t,text:o}=e;return{id:t,text:o,response:n[e.id]||""}}),additionalData:a},c={credentials:"include",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(s)};return fetch("https://www.ft.com/__feedback-api/v1/survey",c)}},e4095750:function(e,t){e.exports=function(e){const t=e.filter(e=>e.questions&&e.questions.length>0);return[].concat(...t.map(e=>e.questions)).map(e=>({id:e.questionId,text:e.questionText}))}},fa7eec55:function(e,t){e.exports=function(e){const{referrer:t,URL:n}=document,{appName:o,product:a,version:s,nativeAppVersion:c,domain:r}=e,d={appName:o||e.name,currentUrl:n,referrerUrl:t,product:a,version:s,domain:r};return c&&(d.nativeAppVersion=c),d}}}]);
//# sourceMappingURL=financial-times-n-feedback.c7d903e910c1.bundle.js.map