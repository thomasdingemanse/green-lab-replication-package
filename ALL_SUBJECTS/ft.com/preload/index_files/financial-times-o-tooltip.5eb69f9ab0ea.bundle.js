(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-o-tooltip"],{"226cb005":function(t,o,e){"use strict";e.r(o);var i=e("d8ac1740"),s=e.n(i),l=e("3c85f3e3"),n=e("efe87a17");var r=class{constructor(t){this.targetEl=t}get offsetTop(){return this.targetEl.offsetTop}get left(){return this.targetEl.getBoundingClientRect().left}get right(){return this.left+this.width}get top(){return this.targetEl.getBoundingClientRect().top}get bottom(){return this.top+this.height}get width(){return this.targetEl.getBoundingClientRect().width}get height(){return this.targetEl.getBoundingClientRect().height}get centrePoint(){return{x:this.left+this.width/2,y:this.top+this.height/2}}};class h{static _getCurrentLayout(){return n.default.getCurrentLayout()}constructor(t,o){h._tooltips||(h._tooltips=new Map),this.opts=o||h.getOptions(t),this.opts=h.checkOptions(this.opts),o&&o.content?this.tooltipEl=h.constructElement(t,o):this.tooltipEl=t,h._tooltips.set(this.tooltipEl,this),this.targetNode=document.getElementById(this.opts.target),this.target=new h.Target(this.targetNode),this.tooltipPosition=this._getConfiguredTooltipPosition(),this.tooltipAlignment=null,this.visible=!1,this.delegates={target:new s.a(this.target.targetEl),doc:new s.a,tooltip:new s.a},this.opts.showOnClick&&this.delegates.target.on("click",this.show.bind(this)),this.opts.toggleOnClick&&this.delegates.target.on("click",this.toggle.bind(this)),this.opts.showOnHover&&(this.delegates.target.on("mouseover",this.show.bind(this)),this.delegates.target.on("mouseout",this.close.bind(this))),this.opts.showOnFocus&&(this.delegates.target.on("focusin",this.show.bind(this)),this.delegates.target.on("focusout",this.close.bind(this))),l.default.listenTo("resize"),this.render(),this.opts.showOnConstruction?(this.show(),this.opts.closeAfter&&this.closeAfter(this.opts.closeAfter)):this.opts.showAfter&&this.showAfter(this.opts.showAfter)}static getOptions(t){const o=t.dataset;return Object.keys(o).reduce((t,e)=>{if("oComponent"===e)return t;const i=e.replace(/^oTooltip(\w)(\w+)$/,(t,o,e)=>o.toLowerCase()+e);try{t[i]=JSON.parse(o[e].replace(/\'/g,'"'))}catch(s){t[i]=o[e]}return t},{})}static checkOptions(t){return t.target||h.throwError("tooltip.target is not set. An target for the tooltip to point at must be provided"),t.position?-1===h.validTooltipPositions.indexOf(t.position)&&h.throwError("Invalid value for tooltip position. Valid values are:"+h.validTooltipPositions.toString()+" or nothing which will default to a value of `below`"):t.position="below",t}static constructElement(t,o){const e=document.createElement("div");return t.setAttribute("id",o.target),e.setAttribute("data-o-component","o-tooltip"),e.insertAdjacentHTML("afterbegin",`<div class='o-tooltip-content'>${o.content}</div>`),e}render(){if(this.opts.appendToBody?document.getElementById(this.opts.target+h.idSuffix)||document.body.appendChild(this.tooltipEl):this.targetNode&&this.targetNode.nextSibling!==this.tooltipEl&&(this.targetNode.nextSibling?this.targetNode.parentNode.insertBefore(this.tooltipEl,this.targetNode.nextSibling):this.targetNode.parentNode.appendChild(this.tooltipEl)),this.tooltipEl.setAttribute("role","tooltip"),this.tooltipEl.classList.add("o-tooltip"),this.opts.zIndex&&(this.tooltipEl.style.zIndex=this.opts.zIndex),this.opts.showOnClick||this.opts.toggleOnClick){const t=document.createElement("button");t.className="o-tooltip-close",t.setAttribute("aria-label","Close tooltip"),t.setAttribute("title","Close tooltip"),this.tooltipEl.appendChild(t)}}show(){this.delegates.doc.root(document.body),this.delegates.tooltip.root(this.tooltipEl),this.tooltipEl.dispatchEvent(new CustomEvent("oTooltip.show")),this.closeHandler=this.close.bind(this),this.delegates.tooltip.on("click",".o-tooltip-close",this.closeHandler),this.delegates.tooltip.on("touchend",".o-tooltip-close",this.closeHandler),this.closeOnKeyUpHandler=this.closeOnKeyUp.bind(this),this.delegates.doc.on("keyup",this.closeOnKeyUpHandler),this.resizeListenerHandler=this.resizeListener.bind(this),this.delegates.doc.on("oViewport.resize","body",this.resizeListenerHandler),this.drawTooltip(),this.visible=!0,clearTimeout(this.showTimeout),this.tooltipEl.style.display="block",this.tooltipEl.style.opacity=1,this.tooltipEl.classList.add("visible")}toggle(){this.visible?this.close():this.show()}closeAfter(t){this.closeTimeout=setTimeout(()=>{this.close()},1e3*t)}showAfter(t){this.showTimeout=setTimeout(()=>{this.show()},1e3*t)}destroy(){!0===this.visible&&this.close(),this.tooltipEl&&this.tooltipEl.parentElement&&this.opts&&this.opts.content&&this.tooltipEl.parentElement.removeChild(this.tooltipEl),h._tooltips.delete(this.tooltipEl),0===h._tooltips.size&&(l.default.stopListeningTo("resize"),delete h._tooltips)}close(t,o){return(!(arguments.length>2&&void 0!==arguments[2])||arguments[2])&&this.tooltipEl.dispatchEvent(new CustomEvent("oTooltip.close")),this.delegates.doc.destroy(),this.delegates.tooltip.destroy(),clearTimeout(this.closeTimeout),this.visible=!1,this.tooltipEl.style.opacity=0,this.tooltipEl.classList.remove("visible"),this.tooltipEl.addEventListener("transitionend",()=>{!1===this.visible&&(this.tooltipEl.style.display="none")},{once:!0}),this.opts.showOnClick&&this.delegates.target.on("click",null,this.show.bind(this)),!1}closeOnKeyUp(t){27===t.keyCode&&this.close()}resizeListener(){this.visible&&window.requestAnimationFrame(()=>{this.drawTooltip()})}drawTooltip(){this.tooltipEl.style.display="block",this.tooltipEl.style["max-width"]=this.width()+"px";let t=0,o={},e=this._getConfiguredTooltipPosition(),i="middle",s=!0;for(;t<5&&s;){switch(t++,e){case"above":({tooltipRect:o,alignment:i,isOutOfBounds:s}=this._evaulateTooltip("above"));break;case"right":({tooltipRect:o,alignment:i,isOutOfBounds:s}=this._evaulateTooltip("right"));break;case"below":({tooltipRect:o,alignment:i,isOutOfBounds:s}=this._evaulateTooltip("below"));break;case"left":({tooltipRect:o,alignment:i,isOutOfBounds:s}=this._evaulateTooltip("left"));break;default:throw h.throwError("drawTooltip entered the default case, which is not expected.")}s&&t<5&&(e=h._rotateOrientation(e))}this.tooltipRect=o,this.tooltipAlignment=i,this.tooltipPosition=e;const l=this.target.targetEl.offsetParent&&this.target.targetEl.offsetParent.getBoundingClientRect().left,n=this.target.targetEl.offsetParent&&this.target.targetEl.offsetParent.getBoundingClientRect().top,r=this.tooltipEl.getBoundingClientRect().width;this.opts.appendToBody?(this.tooltipEl.id=this.opts.target+h.idSuffix,this.tooltipEl.style.top=this.tooltipRect.top+document.documentElement.scrollTop+"px",this.tooltipEl.style.left=this.tooltipRect.left+document.documentElement.scrollLeft+"px"):(this.tooltipEl.style.top=this.tooltipRect.top-n+"px",this.tooltipEl.style.left=this.tooltipRect.left-l+"px");if(r!==this.tooltipEl.getBoundingClientRect().width)return this.drawTooltip();this._setArrow(),t>=5&&console.warn("There is not enough space in the client window to draw the tooltip.")}width(){return this.tooltipEl.offsetWidth}height(){return this.tooltipEl.offsetHeight}_evaulateTooltip(t){const o="y"===("above"===t||"below"===t?"y":"x")?["middle","right","left"]:["middle","top","bottom"];let e,i,s=!0;for(let l=0;l<o.length&&!0===s;l++)i=o[l],e=this._calculateTooltipRectangle(t,i),s=this._tooltipIsOutOfBounds(e);return s&&(i="middle",e=this._calculateTooltipRectangle(t,i)),{tooltipRect:e,alignment:i,isOutOfBounds:s}}_calculateTooltipRectangle(t,o){const e={},i="above"===t||"below"===t?"y":"x";if("y"===i){const i=this.width()/10;"left"===o&&(e.left=this.target.centrePoint.x-this.width()+i),"right"===o&&(e.left=this.target.centrePoint.x-i),"middle"===o&&(e.left=this.target.centrePoint.x-this.width()/2),"above"===t&&(e.top=this.target.top-this.height()-h.arrowDepth),"below"===t&&(e.top=this.target.bottom+h.arrowDepth)}return"x"===i&&("top"===o&&(e.top=this.target.top),"bottom"===o&&(e.top=this.target.bottom-this.height()),"middle"===o&&(e.top=this.target.centrePoint.y-this.height()/2),"right"===t&&(e.left=this.target.right+h.arrowDepth),"left"===t&&(e.left=this.target.left-this.width()-h.arrowDepth)),e.right=e.left+this.width(),e.bottom=e.top+this.height(),e}calculateTooltipRect(t){return console.warn("`calculateTooltipRect` is deprecated."),this._calculateTooltipRectangle(t,"middle")}_getConfiguredTooltipPosition(){const{position:t,positionS:o,positionM:e,positionL:i,positionXl:s}=this.opts;switch(h._getCurrentLayout()){case"S":return o||t;case"M":return e||o||t;case"L":return i||e||o||t;case"XL":return s||i||e||o||t;default:return t}}_setArrow(){this.tooltipEl.classList.remove("o-tooltip--arrow-left","o-tooltip--arrow-right","o-tooltip--arrow-above","o-tooltip--arrow-below","o-tooltip-arrow--align-top","o-tooltip-arrow--align-bottom","o-tooltip-arrow--align-left","o-tooltip-arrow--align-right","o-tooltip-arrow--align-middle"),this.tooltipEl.classList.add("o-tooltip--arrow-"+h.positionToArrowPositionMap[this.tooltipPosition]),this.tooltipEl.classList.add("o-tooltip-arrow--align-"+h.alignmentToArrowAlignmentMap[this.tooltipAlignment])}_tooltipIsOutOfBounds(t){const o=h._pointIsOutOfBounds(t.top,"y",this.opts),e=h._pointIsOutOfBounds(t.bottom,"y",this.opts),i=h._pointIsOutOfBounds(t.left,"x",this.opts),s=h._pointIsOutOfBounds(t.right,"x",this.opts);return o||e||i||s}static _pointIsOutOfBounds(t,o,e){if(t<0)return!0;if(e.showOnConstruction){if("y"===o&&t>document.body.clientHeight)return!0;if("x"===o&&t>document.body.clientWidth)return!0}else{if("y"===o&&t>document.documentElement.clientHeight)return!0;if("x"===o&&t>document.documentElement.clientWidth)return!0}return!1}static _rotateOrientation(t){return{above:"right",right:"below",below:"left",left:"above"}[t]}static throwError(t){throw new Error('"o-tooltip error": '+t)}static init(t,o){return t||(t=document.body),t instanceof HTMLElement||(t=document.querySelector(t)),t instanceof HTMLElement&&/\bo-tooltip\b/.test(t.getAttribute("data-o-component"))?new h(t,o):Array.from(t.querySelectorAll('[data-o-component="o-tooltip"]'),t=>new h(t,o))}}h.idSuffix="-tooltip",h.arrowDepth=10,h.positionToArrowPositionMap={above:"below",below:"above",left:"right",right:"left"},h.alignmentToArrowAlignmentMap={top:"top",bottom:"bottom",right:"left",left:"right",middle:"middle"},h.validArrowAlignments=["top","bottom","left","right"],h.validTooltipPositions=["above","below","left","right"],h.Target=r;var a=h;const p=function(){a.init(),document.removeEventListener("o.DOMContentLoaded",p)};"undefined"!=typeof document&&document.addEventListener("o.DOMContentLoaded",p);o.default=a}}]);
//# sourceMappingURL=financial-times-o-tooltip.5eb69f9ab0ea.bundle.js.map