(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-o-overlay"],{"15baad73":function(t,e,s){"use strict";s.r(e);var o=s("d8ac1740"),i=s.n(o),r=s("3c85f3e3"),n={unCapitalise:function(t){return t.charAt(0).toLowerCase()+t.substr(1)},capitalise:function(t){return t.charAt(0).toUpperCase()+t.substr(1)},copyContentFromElement:function(t,e){e("SCRIPT"===t.nodeName?t.innerHTML:t.outerHTML)},copyContentFromUrl:function(t,e){const s=new XMLHttpRequest;s.open("GET",t,!0),s.onload=function(){4===s.readyState&&(200===s.status?e(s.responseText):e("Content failed to load correctly"))},s.onerror=function(e){throw new Error('"o-overlay error": Fetching content from '+t+" failed with errror "+e)},s.send(null)},optionsFromKey:function(t,e,s){const o=t.indexOf("-");if(-1===o)try{s[t]=JSON.parse(e.replace(/\'/g,'"'))}catch(o){s[t]=e}else{const i=t.substr(0,o);s[i]||(s[i]={}),s[i]=this.optionsFromKey(t.substr(o+1),e,s[i])}return s},getOffsetRect:function(t){const e=t.getBoundingClientRect(),s=document.body,o=document.documentElement,i=window.pageYOffset||o.scrollTop||s.scrollTop,r=window.pageXOffset||o.scrollLeft||s.scrollLeft,n=o.clientTop||s.clientTop||0,a=o.clientLeft||s.clientLeft||0;return{width:e.width||e.right-e.left,height:e.height||e.bottom-e.top,top:e.top+i-n,left:e.left+r-a}}},a=s("7c792dac"),l=s.n(a);const h={},c=function(t){let e={};return t instanceof HTMLElement&&(Array.prototype.forEach.call(t.attributes,(function(t){if(0===t.name.indexOf("data-o-overlay")){const s=t.name.replace("data-o-overlay-","");e=n.optionsFromKey(s,t.value,e)}})),e.trigger=t),e},d=function(t,e){e.stopPropagation();const s=h[t];s&&(!0===s.visible?s.close():s.open())},p=function(t){return Boolean(t.offsetHeight)},u=function(t){const e=[].slice.call(this.wrapper.querySelectorAll(l.a)).filter(t=>{const e=p(t),s=t.labels&&[].slice.call(t.labels).some(t=>p(t)),o="radio"===t.type&&!0!==t.checked;return!t.disabled&&!o&&(e||s)});if(e.length&&9===t.keyCode){const s=e[e.length-1];t.target===s?(e[0].focus(),t.preventDefault()):t.shiftKey&&t.target===e[0]&&(s.focus(),t.preventDefault())}};class g{constructor(t,e){if(h[t])throw new Error(`o-overlay with id "${t}" already exists. Creating an overlay twice with the same id may result in unexpected behaviour.`);r.default.listenTo("resize"),this.visible=!1,this.id=t;try{this.opts=function(t){if(!t.trigger||t.trigger instanceof HTMLElement||(t.trigger=document.querySelector(t.trigger)),t.heading&&(!t.heading.title||!t.heading.title.trim()))throw new Error('"o-overlay error": To have a heading, a non-empty title needs to be set');if(void 0===t.modal&&(t.modal=!0),void 0===t.layer&&(t.layer=!0),t.compact&&t.heading&&t.heading.shaded)throw new Error('"o-overlay error": Compact overlays can\'t have a shaded header');return t}(e)}catch(t){throw this.broadcast("log","oErrors",{error:t}),t}if(!this.opts){const t=new Error('"o-overlay error": Required options have not been set');throw this.broadcast("log","oErrors",{error:t}),t}this.opts.trigger?(this.opts.trigger.addEventListener("click",d.bind(this.opts.trigger,t),!1),this.context=document.body):document.querySelector(this.opts.parentnode)?this.context=document.querySelector(this.opts.parentnode):this.context=document.body,this.delegates={doc:new i.a,wrap:new i.a,context:new i.a},h[t]=this}open(){if((this.opts.modal||this.opts.fullscreen)&&(this.originalOverflow=document.documentElement.style.overflow,document.documentElement.style.overflow="hidden"),window.history.pushState&&this.opts.fullscreen&&(window.history.pushState({["o-overlay-"+this.id]:"fullscreen"},window.location.href),this.popstateHandler=function(){window.history.state&&window.history.state["o-overlay-"+this.id]&&this.close()}.bind(this),window.addEventListener("popstate",this.popstateHandler)),this.opts.trigger&&this.opts.trigger.setAttribute("aria-pressed","true"),this.content)this.show();else{const t=this;this.loadContent((function(e){if(t.opts.html=e,!t.opts.html)throw new Error('"o-overlay error": Content for the overlay needs to be set via the "html" or the "src" option.');t.render()}))}}loadContent(t){!this.opts.html&&this.opts.src?/^(https?\:\/)?\//.test(this.opts.src)?n.copyContentFromUrl(this.opts.src,(function(e){t(e)})):n.copyContentFromElement(document.querySelector(this.opts.src),(function(e){t(e)})):t(this.opts.html)}render(){const t=document.createElement("div");if(t.className="o-overlay",t.classList.add("o-overlay--"+this.id.replace(" ","-")),this.opts.class)try{t.classList.add(...this.opts.class.split(" "))}catch(t){console.warn("Could not add the classes: "+this.opts.class)}if(this.opts.fullscreen&&t.classList.add("o-overlay--full-screen"),t.setAttribute("role","dialog"),this.opts.zindex&&(t.style.zIndex=this.opts.zindex),this.wrapper=t,this.opts.heading){const e=document.createElement("header"),s=this.opts.heading.title.toLowerCase().replace(/[^a-z0-9-]/g,"-").replace(/[\s-]+/g,"-");if(e.classList.add("o-overlay__heading"),t.setAttribute("aria-labelledby",s),this.opts.heading.shaded&&e.classList.add("o-overlay__heading--shaded"),!this.opts.preventclosing){const t=document.createElement("button");t.className="o-overlay__close",t.setAttribute("aria-label","Close"),t.setAttribute("title","Close"),this.opts.nofocus||t.setAttribute("tabindex","0"),e.appendChild(t)}const o=document.createElement("span");o.setAttribute("role","heading"),o.setAttribute("aria-level","1"),o.className="o-overlay__title",o.innerHTML=this.opts.heading.title,o.setAttribute("id",s),this.opts.heading.visuallyhidetitle&&o.classList.add("o-overlay__title--sr-only"),e.appendChild(o),t.appendChild(e)}if(this.opts.tooltip){const e=document.createElement("a");e.className="o-overlay__close",e.setAttribute("role","button"),e.setAttribute("href","#void"),e.setAttribute("aria-label","Close"),e.setAttribute("title","Close"),this.opts.nofocus||e.setAttribute("tabindex","0"),t.appendChild(e),t.classList.add("o-overlay--compact")}const e=document.createElement("section");e.className="o-overlay__content",t.appendChild(e),this.content=e,this.opts.compact&&t.classList.add("o-overlay--compact"),this.show()}_trapFocus(){document.addEventListener("keydown",u.bind(this))}show(){if(this.opts.modal){this.wrapper.classList.add("o-overlay--modal");const t=document.createElement("div");t.className="o-overlay-shadow",this.shadow=t,this.opts.zindex&&(t.style.zIndex=this.opts.zindex-1),document.body.appendChild(t)}this.delegates.doc.root(document.body),this.delegates.wrap.root(this.wrapper),this.delegates.context.root(this.context),this.closeHandler=this.close.bind(this),this.opts.nested||(this.resizeListenerHandler=this.resizeListener.bind(this),this.delegates.doc.on("oViewport.resize","body",this.resizeListenerHandler),this.closeOnEscapePressHandler=this.closeOnEscapePress.bind(this),this.delegates.doc.on("keyup",this.closeOnEscapePressHandler)),this.opts.layer&&(this.closeOnNewLayerHandler=this.closeOnNewLayer.bind(this),this.delegates.context.on("oOverlay.layerOpen",this.closeOnNewLayerHandler),this.broadcast("layerOpen")),(this.opts.heading||this.opts.tooltip||this.opts.customclose)&&(this.delegates.wrap.on("click",".o-overlay__close",this.closeHandler),this.delegates.wrap.on("touchend",".o-overlay__close",this.closeHandler)),this.closeOnExternalClickHandler=this.closeOnExternalClick.bind(this),this.delegates.doc.on("click","body",this.closeOnExternalClickHandler),this.delegates.doc.on("touchend","body",this.closeOnExternalClickHandler),this.context.appendChild(this.wrapper),this.opts.nofocus||(this.wrapper.setAttribute("tabindex","0"),this.wrapper.style.outline=0),window.requestAnimationFrame(function(){this.content.innerHTML||("string"==typeof this.opts.html?this.content.innerHTML=this.opts.html:this.content.appendChild(this.opts.html)),this.width=this.getWidth(),this.height=this.getHeight(),this.opts.nested||this.realign(),this.visible=!0,this.wrapper.focus(),this.broadcast("ready","oOverlay",{instance:this}),this.broadcast("event","oTracking",{category:"overlay",action:"show",overlay_id:this.id}),this._trapFocus()}.bind(this))}close(){return this.delegates.doc.destroy(),this.delegates.wrap.destroy(),this.delegates.context.destroy(),(this.opts.modal||this.opts.fullscreen)&&(document.documentElement.style.overflow=this.originalOverflow),this.opts.fullscreen&&window.removeEventListener("popstate",this.popstateHandler),window.history.pushState&&window.history.state&&"fullscreen"===window.history.state["o-overlay-"+this.id]&&window.history.back(),r.default.stopListeningTo("resize"),this.broadcast("destroy"),this.broadcast("event","oTracking",{category:"overlay",action:"close",overlay_id:this.id}),this.context.removeChild(this.wrapper),this.opts.modal&&this.shadow.parentNode.removeChild(this.shadow),this.opts.trigger&&(this.opts.trigger.focus(),this.opts.trigger.setAttribute("aria-pressed","false")),document.removeEventListener("keydown",u),this.visible=!1,this.opts.layer&&this.broadcast("layerClose"),!1}closeOnExternalClick(t){this.wrapper.contains(t.target)||this.opts.modal||!this.opts.trigger||this.opts.trigger.contains(t.target)||this.close()}closeOnEscapePress(t){this.opts.preventclosing||27!==t.keyCode||this.close()}closeOnNewLayer(t){t.detail&&t.detail.el===this||this.close()}resizeListener(t){this.wrapper.contains(t.target)||this.respondToWindow()}broadcast(t,e,s){e=e||"oOverlay";const o="layerOpen"===t||"layerClose"===t?this.context:this.wrapper||document.body;s=s||{},"oTracking"!==e&&(s.el=this),o.dispatchEvent(new CustomEvent(e+"."+t,{detail:s,bubbles:!0}))}realign(t,e){if(!t&&!e)return this._align("width",r.default.getSize().width),void this._align("height",r.default.getSize().height);!t||e?this._align(t,e):this._align(t,r.default.getSize().dimension)}_align(t,e){if("width"!==t&&"height"!==t)throw new Error(`Can not realign the overlay for the dimension "${t}". "height" or "width" expected.`);if(isNaN(e))throw new Error(`Can not realign the overlay for the size ${e}. A number is expected.`);const s="width"===t?"left":"top";if(this.width=this.getWidth(),this.height=this.getHeight(),e<=this[t]){if(this.wrapper.classList.add("o-overlay--full-"+t),this.wrapper.style[s]="0",this.wrapper.style["margin"+n.capitalise(s)]=0,"height"===t){const t=this.wrapper.offsetHeight-this.wrapper.clientHeight;this.content.style.height=this.wrapper.offsetHeight-(this.opts.heading?this.wrapper.querySelector("header").offsetHeight:0)-t+"px"}}else"height"===t&&(this.content.style.height=null),this.wrapper.classList.remove("o-overlay--full-"+t),this.wrapper.style["margin"+n.capitalise(s)]=-this.wrapper["offset"+n.capitalise(t)]/2+"px",this.wrapper.style[s]="50%"}respondToWindow(){this.realign()}fills(t){return this.wrapper.classList.contains("o-overlay--full-"+t)}destroy(){!0===this.visible&&this.close(),this.opts.trigger&&this.opts.trigger.removeEventListener("click",d),delete h[this.id]}getHeight(){const t=this.wrapper.offsetHeight-this.wrapper.clientHeight;return this.content.scrollHeight+(this.opts.heading?this.wrapper.querySelector("header").offsetHeight:0)+t}getWidth(){const t=this.wrapper.offsetWidth-this.wrapper.clientWidth;return this.content.scrollWidth+t}static init(t){t||(t=document.body),t instanceof HTMLElement||(t=document.querySelector(t));const e=t.querySelectorAll(".o-overlay-trigger"),s=[];for(let t=0;t<e.length;t++)h[e[t].getAttribute("data-o-overlay-id")]||s.push(new g(e[t].getAttribute("data-o-overlay-id"),c(e[t])));return s}static destroy(){Object.keys(h).forEach((function(t){h[t].destroy()}))}static getOverlays(){return h}}var y=g;const w=function(){y.init(),document.removeEventListener("o.DOMContentLoaded",w)};document.addEventListener("o.DOMContentLoaded",w);e.default=y}}]);
//# sourceMappingURL=financial-times-o-overlay.09ed63bf2911.bundle.js.map