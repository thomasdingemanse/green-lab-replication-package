(window.webpackJsonp=window.webpackJsonp||[]).push([["financial-times-o-tracking"],{"6d73a2e3":function(t,e,n){"use strict";n.r(e);const o={config:{}};function r(t){if(void 0===t)return t;switch(Object.prototype.toString.call(t)){case"[object Object]":return JSON.parse(JSON.stringify(t));case"[object Array]":return[].slice.call(t);default:return t}}function i(t){delete o[t]}const c=function(t,e){o[t]=r(e)},a=function(t){return r(o[t])};let s=0;const u=Math.pow(36,4),f=function(t,e){const n="000000000"+t;return n.substr(n.length-e)},l=function(){return f((Math.random()*u<<0).toString(36),4)},d=()=>(s=s<u?s:0,s++,s-1),g=function(){const t=(new Date).getTime().toString(36),e=g.fingerprint(),n=l()+l();return"c"+t+f(d().toString(36),4)+e+n};g.slug=function(){const t=(new Date).getTime().toString(36),e=g.fingerprint().slice(0,1)+g.fingerprint().slice(-1),n=l().slice(-2),o=d().toString(36).slice(-4);return t.slice(-2)+o+e+n},g.globalCount=function(){const t=function(){let t=0;for(const e in window)t++;return t}();return g.globalCount=()=>t,t},g.fingerprint=function(){return f((navigator.mimeTypes.length+navigator.userAgent.length).toString(36)+g.globalCount().toString(36),4)};const h=[];function p(){if(a("config").test&&window.console){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(const t of e)window.console.log(t)}}function m(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"undefined";return typeof t===e}function w(t,e){let n,o,r;for(n in e||(e=t,t={}),e)o=t[n],r=e[n],t!==r&&null!=r&&(t[n]=o!==Object(o)||m(o,"function")?r:w(o,r));return t}function y(t){return window.encodeURIComponent?window.encodeURIComponent(t):window.escape(t)}function v(t){return window.decodeURIComponent?window.decodeURIComponent(t):window.unescape(t)}function b(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)}function k(t,e,n){n=n||{};try{window.dispatchEvent(new CustomEvent(t+"."+e,{detail:n,bubbles:!0}))}catch(t){}}function O(t){return document.cookie.match(t)&&""!==RegExp.$1&&"null"!==RegExp.$1?RegExp.$1:null}function x(t){return"string"==typeof t?t.trim():t}function E(t,e){for(const n in t)e[n]?console.warn("You can't set a custom property called "+n):e[n]=t[n]}function S(t){const e=new WeakSet,n=[];return function t(o,r){if(e.has(o))n.push(r);else if(o instanceof Object){e.add(o);for(const[e,n]of Object.entries(o))if(n instanceof Object){t(n,Array.isArray(o)?`${r}[${e}]`:`${r}.${e}`)}}}(t,""),n}function _(t){const e=new WeakSet;return Boolean(function t(n){if(e.has(n))return!0;if(n instanceof Object){e.add(n);for(const e of Object.values(n))if(e instanceof Object&&t(e))return!0}}(t))}const C=function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n="o-tracking";if("string"!=typeof t||""===t){const t=new Error("You must specify a name for the store.");throw k("oErrors","log",{error:t.message,info:{module:"o-tracking"}}),t}function o(t){t+="=";const e=window.document.cookie.split(";");let n,o;for(n=0;n<e.length;n+=1)if(o=e[n].replace(/^\s+|\s+$/g,""),0===o.indexOf(t))return v(o.substring(t.length,o.length));return null}function r(t,n,o){let r,i="";m(o,"number")&&(r=new Date,r.setTime(r.getTime()+o),i="expires="+r.toUTCString()+";");const c=y(t)+"="+y(n)+";"+i+"path=/;"+(e.domain?"domain=."+e.domain+";":"");window.document.cookie=c}function i(t){r(t,"",-1)}this.config=Object.assign({},e),this.data=null,this.storageKey=this.config.nameOverride?this.config.nameOverride:[n,t].join("_"),this.storage={_type:"localStorage",load:function(t){return window.localStorage.getItem(t)},save:function(t,e){return window.localStorage.setItem(t,e)},remove:function(t){return i(t),window.localStorage.removeItem(t)}};const c=this.storage.load(this.storageKey);if(c)try{this.data=JSON.parse(c)}catch(t){k("oErrors","log",{error:t.message,module:"o-tracking"}),this.data=c}const a=o(this.storageKey);if(a)try{if("spoor-id"===this.storageKey)this.data=a;else{const t=JSON.parse(a);this.data?Object.assign(this.data,t):this.data=t;for(const e of Object.keys(t))"spoor-id"!==e&&i(e)}}catch(t){k("oErrors","log",{error:t.message,module:"o-tracking"}),this.data=c}return this};let j,q,A;function T(t,e){const n={storage:"cookie",name:"spoor-id",nameOverride:"spoor-id",value:null,domain:location.hostname.match(/^(?:.+\.)?ft\.com$/)?"ft.com":null};e&&(n.domain=e),q=new C(n.name,n);let o=q.read();return o||(o=t),I(o)}function I(t){return j=t,j||(j=g()),q.write(j),j}function D(){return j}C.prototype.read=function(){return this.data},C.prototype.write=function(t){let e;if(this.data=t,"string"==typeof this.data)e=this.data;else{if(_(this.data)){const t="o-tracking does not support circular references in the analytics data.\nPlease remove the circular references in the data.\nHere are the paths in the data which are circular:\n"+JSON.stringify(S(this.data),void 0,4);throw new Error(t)}e=JSON.stringify(this.data)}return this.storage.save(this.storageKey,e),this},C.prototype.destroy=function(){return this.data=null,this.storage.remove(this.storageKey),this};const N={storage:"best",name:"session",expires:18e5};function R(){const t=A.read();let e,n=!1;if(t){const n=(new Date).valueOf();parseInt(t.expiry,10)>=n&&(e=t.value)}return e||(e=g(),n=!0),function(t){const e=new Date;e.setTime(e.getTime()+A.config.expires),A.write({value:t,expiry:e.valueOf()})}(e),{id:e,isNew:n}}function L(t){m(t,"string")&&(t={name:t}),m(t)&&(t={});const e=w(N,t);return"cookie"===e.storage&&t.name&&(e.nameOverride=e.name),A=new C(e.name,e),R()}function J(t){if(m(t)){const t=new Error("You must specify a name for the queue.");throw k("oErrors","log",{error:t.message,info:{module:"o-tracking"}}),t}return this.queue=[],this.storage=new C(t),this.storage.read()&&(this.queue=this.storage.read()),this}function $(){const t=new window.XMLHttpRequest;return{name:"xhr",send:function(e,n){t.open("POST",e,!0),t.withCredentials=!0,t.setRequestHeader("Content-type","application/json"),t.send(n)},complete:function(e){t.onerror=function(){e(this)},t.onload=function(){t.status>=200&&t.status<300?e():e("Incorrect response: "+t.status)}}}}function K(){let t,e;const n=new Promise((n,o)=>{t=n,e=o});return{name:"sendBeacon",send:function(n,o){navigator.sendBeacon(n,o)?t():e(new Error("Failed to send beacon event: "+o.toString()))},complete:function(t){t&&n.then(t,t)}}}function M(){const t=new Image(1,1);return{name:"image",send:function(e,n){e=e.replace("https://spoor-api.ft.com/ingest","https://spoor-api.ft.com/px.gif"),t.src=e+(e.indexOf("?")>-1?"&":"?")+"data="+y(n)},complete:function(e){t.addEventListener?(t.addEventListener("error",e),t.addEventListener("load",()=>e())):(t.attachEvent("onerror",e),t.attachEvent("onload",()=>e()))}}}J.prototype.all=function(){if(0===this.queue.length)return[];const t=[];for(let e=0;e<this.queue.length;e+=1)t.push(this.queue[e].item);return t},J.prototype.first=function(){return 0===this.queue.length?null:this.queue[0].item},J.prototype.last=function(){return 0===this.queue.length?null:this.queue.slice(-1)[0].item},J.prototype.add=function(t){const e=this;let n;function o(t){e.queue.push({created_at:(new Date).valueOf(),item:t})}if(m(t,"object")&&t.constructor.toString().match(/array/i))for(n=0;n<t.length;n+=1)o(t[n]);else o(t);return e},J.prototype.replace=function(t){if(Array.isArray(t))return this.queue=[],this.add(t).save(),this;const e=new Error("Argument invalid, must be an array.");throw k("oErrors","log",{error:e.message,info:{module:"o-tracking"}}),e},J.prototype.shift=function(){if(0===this.queue.length)return null;const t=this.queue.shift().item;return this.save(),t},J.prototype.save=function(){return this.storage.write(this.queue),this};const P={};function B(t){if(P.transport)return P.transport;switch(t){case"xhr":return $;case"sendBeacon":return K;case"image":return M;default:return}}let U,H;function F(){return!0!==(a("config")||{}).queue&&Boolean(navigator.sendBeacon)}function X(t,e){const n=t.queueTime,o=(new Date).getTime()-n,r=F()?B("sendBeacon")():window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest?B("xhr")():B("image")(),i=t.callback,c=w(a("config")&&a("config").system||{},{version:a("version"),source:a("source"),transport:r.name});if(a("config").test?c.is_live=!1:c.is_live=!0,t=w({system:c},t),o>1e3&&o<31104e6&&(t.time=t.time||{},t.time.offset=o),delete t.callback,delete t.type,delete t.queueTime,p("user_callback",i),p("PreSend",t),_(t)){const e="o-tracking does not support circular references in the analytics data.\nPlease remove the circular references in the data.\nHere are the paths in the data which are circular:\n"+JSON.stringify(S(t),void 0,4);throw new Error(e)}const s=JSON.stringify(t);r.complete((function(o){m(i,"function")&&(i.call(t),p("calling user_callback")),o?(t.queueTime=n,U.add(t).save(),k("oErrors","log",{error:o.message,info:{module:"o-tracking"}})):e&&e()}));let u="https://spoor-api.ft.com/ingest";t&&t.category&&t.action&&(u+=`?type=${t.category}:${t.action}`),r.send(u,s)}function Y(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};const e=U.all();if(e.length>200){const t={};e.forEach((function(e){const n=[e.category,e.action].join(":");Object.prototype.hasOwnProperty.call(t,n)||(t[n]=0),t[n]+=1})),U.replace([]),U.add({category:"o-tracking",action:"queue-bug",context:{url:document.URL,queue_length:e.length,counts:t,storage:U.storage.storage._type}})}const n=function(){Y(),t()},o=U.shift();return o?X(o,n):t()}function W(t){!function(t){t.queueTime=(new Date).getTime(),F()?X(t):U.add(t).save(),p("AddedToQueue",U)}(t),Y()}function Q(){return U=new J("requests"),b(window,"online",(function(){Y()})),Y(),U}function z(){return H=g(),H}function G(){return H||z(),H}var V={setRootID:z,getRootID:G,track:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};const n=R(),o={callback:e,context:{id:t.id||g(),root_id:G()},user:{ft_session:O(/FTSession=([^;]+)/),ft_session_s:O(/FTSession_s=([^;]+)/)},device:{spoor_session:n.id,spoor_session_is_new:n.isNew,spoor_id:D()}},r=a("config")||{};return r.context&&w(o.context,r.context),r.user&&w(o.user,r.user),r.device&&w(o.device,r.device),w(o,t),p("Core.Track",o),W(o),o}};function Z(t,e){if(m(t.detail.category)||m(t.detail.action)){const t="Missing category or action values";throw k("oErrors","log",{error:t,info:{module:"o-tracking"}}),t}const n=w({category:"event",action:"generic",context:{}},{category:t.detail.category,action:t.detail.action,context:t.detail});delete n.context.category,delete n.context.action;const o=function(t){const e=t.target||t.srcElement;if(e&&e.getAttribute("data-o-component"))return e}(t);o&&(n.context.component_name=o.getAttribute("data-o-component"),n.context.component_id=n.context.component_id||function(t){const e=function(t){const e=[];for(;t;)e.push(t),t=t.parentElement;return e}(t);if(void 0===e)return;const n=e[0],o=function(t){const e=t.parentElement;if(e){for(let t=0;t<e.childNodes.length;t++)if(e.childNodes[t]===n)return t;return-1}return 0}(n);return function(t){let e,n=t.length,o=1^n,r=0;for(;n>=4;)e=255&t.charCodeAt(r)|(255&t.charCodeAt(++r))<<8|(255&t.charCodeAt(++r))<<16|(255&t.charCodeAt(++r))<<24,e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16),e^=e>>>24,e=1540483477*(65535&e)+((1540483477*(e>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^e,n-=4,++r;switch(n){case 3:o^=(255&t.charCodeAt(r+2))<<16;break;case 2:o^=(255&t.charCodeAt(r+1))<<8;break;case 1:o^=255&t.charCodeAt(r),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)}return o^=o>>>13,o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16),o^=o>>>15,o>>>0}(e.reduceRight((function(t,e){if(!e.nodeName)return t+" - "+e.constructor.name+"\n";const n=e.nodeName.toLowerCase();return 0===n.indexOf("#")?t+"<"+n+">":t+"<"+n+' id="'+(e.id||"")+'">'}),"")+"_siblingIndex="+o)}(o)),V.track(n,e)}Z.init=function(){b(window,"oTracking.event",Z)},c("page_has_already_been_viewed",!1);function tt(t,e){t=w({category:"page",action:"view",context:{url:document.URL,referrer:document.referrer}},{context:t}),a("page_has_already_been_viewed")&&V.setRootID(),c("page_has_already_been_viewed",!0),function(t){const e=JSON.parse(JSON.stringify(t));return delete e.context.id,delete e.context.root_id,!!function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){if(e.constructor!==n.constructor)return!1;if(Array.isArray(e)){const o=e.length;if(o!==n.length)return!1;for(let r=o;0!=r--;)if(!t(e[r],n[r]))return!1;return!0}if(e.constructor===RegExp)return e.source===n.source&&e.flags===n.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===n.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===n.toString();const o=Object.keys(e),r=o.length;if(r!==Object.keys(n).length)return!1;for(let t=r;0!=t--;)if(!Object.prototype.hasOwnProperty.call(n,o[t]))return!1;for(let i=r;0!=i--;){const r=o[i];if(!t(e[r],n[r]))return!1}return!0}}(et,e)||(et=e,!1)}(t)?a("config").test&&console.warn("A page event has already been sent for this page, refusing to send a duplicate page event."):(V.track(t,e),function(){for(let t=0;t<h.length;t++)h[t]()}())}let et={};function nt(t){tt(t.detail)}tt.init=function(){b(window,"oTracking.page",nt)};var ot=n("e6b19cd3");const rt=(t,e,n)=>{const o=Array.from(t.querySelectorAll(n)),r=o.findIndex(t=>t===e);if(-1!==r)return{siblings:o.length,position:r}},it=["nodeName","className","id","href","text","role"],ct=t=>{const e={};for(const n of it){const o=t[n]||t.getAttribute(n)||t.hasAttribute(n);void 0!==o&&(e[n]="boolean"==typeof o?o:x(o))}return e},at=(t,e)=>(t.filter(t=>t.name.match(/^data-trackable|^data-o-|^aria-/i)).forEach(t=>{e[t.name]=t.value}),e),st=(t,e,n)=>{const o={};return n&&it.forEach(t=>{void 0!==e[t]&&"id"!==t&&(o[t]=e[t])}),t.filter(t=>t.name.match(/^data-trackable-context-/i)).forEach(t=>{o[t.name.replace("data-trackable-context-","")]=t.value}),o};function ut(t){const e=document,n=t,o=n.getAttribute("data-trackable")?`[data-trackable="${n.getAttribute("data-trackable")}"]`:n.nodeName,r=[],i={};for(;t&&t!==e;){const e=ct(t),c=Array.from(t.attributes);let a=at(c,e);a["data-trackable"]&&(a=Object.assign(a,rt(t,n,o))),r.push(a);E(st(c,e,t===n),i),t=t.parentNode}return{trace:r,customContext:i}}let ft;const lt=["ctrlKey","altKey","shiftKey","metaKey"],dt=t=>(e,n)=>{if("true"===n.getAttribute("data-o-tracking-do-not-track"))return;const o=(t=>{const e={};for(const n of lt)if(t[n])try{e[n]=x(t[n])}catch(t){console.log(t)}return e})(e),{trace:r,customContext:i}=ut(n);o.domPathTokens=r,o.url=window.document.location.href||null,o.source_id=V.getRootID(),E(i,o),t.context=o;const c=w(a("config"),t);V.track(c)};const gt={init:(t,e)=>{e=e||'a, button, input, [role="button"]';const n={action:"click",category:t||"o-tracking"};ft=ft||new ot.default(document.body),ft.on("click",e,dt(n),!0);!function t(e){const n=e.shift();n&&V.track(n,()=>t(e))}(new J("clicks"))}},ht=["componentContentId","type","subtype","component"],pt=(t,e,n)=>{const{trace:o,customContext:r}=ut(e);let i;if(n.getContextData){if("function"!=typeof n.getContextData)throw new Error("opts.getContextData is not a function");const t=n.getContextData(e);if("object"!=typeof t)throw new Error("opts.getContextData function should return {object}");i=function(t,e){const n={};for(const o of e)t[o]&&(n[o]=t[o]);return n}(t,ht)}else i={};i.domPathTokens=o,i.url=window.document.location.href||null,E(r,i),t.context=i},mt={init:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!window.IntersectionObserver)return void console.warn('o-tracking: Unable to track component view events as "window.IntersectionObserver" is not supported.');const e=t.selector||"[data-o-tracking-view]",n=[...document.querySelectorAll(e)];if(!n.length)return;function o(e){e.forEach(e=>{if(e.isIntersecting||e.intersectionRatio>0){const n={action:t.action||"view",category:t.category||"component"},o=e.target;pt(n,o,t),V.track(n),r.unobserve(o)}})}const r=new IntersectionObserver(o,{threshold:[1]});n.forEach(t=>r.observe(t))}},wt=Z.init,yt=tt.init;function vt(t){let e=a("config")||{};e=w(e,t),c("config",e),e.user&&e.user.user_id&&I(e.user.user_id)}function bt(){return document.querySelector("script[data-o-tracking-config]")}function kt(t){const e=bt();let n;if(!e)return!1;n=e.textContent||e.innerText||e.innerHTML;try{const e=JSON.parse(n);Object.assign(t,e)}catch(t){const e=new Error('Invalid JSON configuration syntax, check validity for o-tracking configuration: "'+t.message+'"');throw k("oErrors","log",{error:e.message,info:{module:"o-tracking"}}),e}return t}const Ot={initialised:!1,version:"4.0.1",updateConfig:vt,source:"o-tracking",destroy:function(){Ot.initialised=!1,i("config"),i("page_sent")},toString:function(){return"oTracking version 4.0.1"},init:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(Ot.initialised)return Ot;const e=Boolean(bt());if(e&&(t=kt(t)),0===Object.keys(t).length&&t.constructor===Object)return null;c("version","4.0.1"),c("source","o-tracking"),c("page_sent",!1);const n=t?t.cookieDomain:"";return T("",n),vt(t),L(t.session),Q(),wt(),yt(),Ot.initialised=!0,Ot},click:gt,event:Z,page:tt,view:mt,getRootID:V.getRootID};var xt=Ot;document.addEventListener("o.DOMContentLoaded",(function t(){xt.init(),document.removeEventListener("o.DOMContentLoaded",t)}));e.default=xt}}]);
//# sourceMappingURL=financial-times-o-tracking.f73f13561401.bundle.js.map