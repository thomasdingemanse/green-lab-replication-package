(function (define) {!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((e=e||self)["LDClient-Common"]={})}(this,function(e){"use strict";function h(n,e){var t,r=Object.keys(n);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(n),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),r.push.apply(r,t)),r}function ee(r){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?h(Object(i),!0).forEach(function(e){var n,t;n=r,t=i[e=e],e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):h(Object(i)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(i,e))})}return r}function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function b(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){var t;if(e)return"string"==typeof e?r(e,n):"Map"===(t="Object"===(t=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:t)||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?r(e,n):void 0}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}function n(e){function n(e,n){Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.message=e,this.code=n}return(n.prototype=new Error).name=e,n.prototype.constructor=n}var L=n("LaunchDarklyUnexpectedResponseError"),te=n("LaunchDarklyInvalidEnvironmentIdError"),i=n("LaunchDarklyInvalidUserError"),pe=n("LaunchDarklyInvalidEventKeyError"),k=n("LaunchDarklyInvalidArgumentError"),re=n("LaunchDarklyFlagFetchError"),me=n("LaunchDarklyInvalidDataError");function A(e){return!(400<=e&&e<500)||(400===e||408===e||429===e)}for(var E=Object.freeze({__proto__:null,LDUnexpectedResponseError:L,LDInvalidEnvironmentIdError:te,LDInvalidUserError:i,LDInvalidEventKeyError:pe,LDInvalidArgumentError:k,LDFlagFetchError:re,LDInvalidDataError:me,isHttpErrorRecoverable:A}),w=function(e){for(var n,t=e.length,r=t%3,i=[],o=0,a=t-r;o<a;o+=16383)i.push(function(e,n,t){for(var r,i=[],o=n;o<t;o+=3)r=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),i.push(function(e){return u[e>>18&63]+u[e>>12&63]+u[e>>6&63]+u[63&e]}(r));return i.join("")}(e,o,a<o+16383?a:o+16383));1==r?(n=e[t-1],i.push(u[n>>2]+u[n<<4&63]+"==")):2==r&&(n=(e[t-2]<<8)+e[t-1],i.push(u[n>>10]+u[n>>4&63]+u[n<<2&63]+"="));return i.join("")},u=[],t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,D=t.length;o<D;++o)u[o]=t[o],t.charCodeAt(o),o;"-".charCodeAt(0),"_".charCodeAt(0);function s(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var t,r,i=P(e),o=P(n);if(i&&o){if((a=e.length)!=n.length)return!1;for(t=a;0!=t--;)if(!s(e[t],n[t]))return!1}else{if(i!=o)return!1;i=e instanceof Date,o=n instanceof Date;if(i!=o)return!1;if(i&&o)return e.getTime()==n.getTime();i=e instanceof RegExp,o=n instanceof RegExp;if(i!=o)return!1;if(i&&o)return e.toString()==n.toString();var a,u=S(e);if((a=u.length)!==S(n).length)return!1;for(t=a;0!=t--;)if(!U.call(n,u[t]))return!1;for(t=a;0!=t--;)if(!s(e[r=u[t]],n[r]))return!1}return!0}return e!=e&&n!=n}var P=Array.isArray,S=Object.keys,U=Object.prototype.hasOwnProperty,I=["key","secondary","ip","country","email","firstName","lastName","avatar","name"];function C(e,n){return(e.endsWith("/")?e.substring(0,e.length-1):e)+(n.startsWith("/")?"":"/")+n}function c(e){e=unescape(encodeURIComponent(e));return w(function(e){for(var n=[],t=0;t<e.length;t++)n.push(e.charCodeAt(t));return n}(e))}function O(e){return c(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function ie(e){return JSON.parse(JSON.stringify(e))}function oe(e,n){return s(e,n)}function ae(e){setTimeout(e,0)}function ue(e,n){e=e.then(function(e){return n&&setTimeout(function(){n(null,e)},0),e},function(e){if(!n)return Promise.reject(e);setTimeout(function(){n(e,null)},0)});return n?void 0:e}function j(e){var n,t={};for(n in e)le(e,n)&&(t[n]={value:e[n],version:0});return t}function se(e){var n,t={};for(n in e)le(e,n)&&(t[n]=e[n].value);return t}function T(e,n){for(var t,r=n.slice(0),i=[],o=e;0<r.length;){for(t=[];0<o;){var a=r.shift();if(!a)break;(o-=O(JSON.stringify(a)).length)<0&&0<t.length?r.unshift(a):t.push(a)}o=e,i.push(t)}return i}function R(e){var n=e.version||"3.7.0";return e.userAgent+"/"+n}function ce(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return n.reduce(function(e,n){return ee(ee({},e),n)},{})}function le(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function ye(e){if(!e)return e;var n,t;for(t in I){var r=I[t],i=e[r];void 0!==i&&"string"!=typeof i&&((n=n||ee({},e))[r]=String(i))}return n||e}var N=Object.freeze({__proto__:null,appendUrlPath:C,btoa:c,base64URLEncode:O,clone:ie,deepEquals:oe,onNextTick:ae,wrapPromiseCallback:ue,transformValuesToVersionedValues:j,transformVersionedValuesToValues:se,chunkUserEventsForUrl:T,getLDUserAgentString:R,extend:ce,objectHasOwnProperty:le,sanitizeUser:ye});(function(e){var n,t,r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);r?(n=new Uint8Array(16),e.exports=function(){return r(n),n}):(t=new Array(16),e.exports=function(){for(var e,n=0;n<16;n++)0==(3&n)&&(e=4294967296*Math.random()),t[n]=e>>>((3&n)<<3)&255;return t})})(F={exports:{}});for(var F,x=F.exports,_=[],a=0;a<256;++a)_[a]=(a+256).toString(16).substr(1);var V,l,q=function(e,n){var n=n||0,t=_;return[t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],"-",t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],t[e[n++]],t[e[+n]]].join("")},f=0,d=0;var v=function(e,n,t){var r=n&&t||0,i=n||[],o=(e=e||{}).node||V,t=void 0!==e.clockseq?e.clockseq:l,a=(null!=o&&null!=t||(a=x(),null==o&&(o=V=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==t&&(t=l=16383&(a[6]<<8|a[7]))),void 0!==e.msecs?e.msecs:(new Date).getTime()),u=void 0!==e.nsecs?e.nsecs:d+1,s=a-f+(u-d)/1e4;if(s<0&&void 0===e.clockseq&&(t=t+1&16383),1e4<=(u=(s<0||f<a)&&void 0===e.nsecs?0:u))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");f=a,l=t,s=(1e4*(268435455&(a+=122192928e5))+(d=u))%4294967296,i[r++]=s>>>24&255,i[r++]=s>>>16&255,i[r++]=s>>>8&255,i[r++]=255&s,e=a/4294967296*1e4&268435455,i[r++]=e>>>8&255,i[r++]=255&e,i[r++]=e>>>24&15|16,i[r++]=e>>>16&255,i[r++]=t>>>8|128,i[r++]=255&t;for(var c=0;c<6;++c)i[r+c]=o[c];return n||q(i)},g=["debug","info","warn","error","none"];function M(e,u){if(e&&e.destination&&"function"!=typeof e.destination)throw new Error("destination for basicLogger was set to a non-function");function n(n){return function(e){console&&console[n]&&console[n].call(console,e)}}var s=e&&e.destination?[e.destination,e.destination,e.destination,e.destination]:[n("log"),n("info"),n("warn"),n("error")],c=!(!e||!e.destination),l=e&&void 0!==e.prefix&&null!==e.prefix?e.prefix:"[LaunchDarkly] ",t=1;if(e&&e.level)for(var r=0;r<g.length;r++)g[r]===e.level&&(t=r);for(var i={},o=function(e){var o,a=g[e];"none"!==a&&(e<t?i[a]=function(){}:(o=e,i[a]=function(){var e=o,n=a,t=arguments;if(!(t.length<1)){var r=c?n+": "+l:l,i=1!==t.length&&u?((i=b(t))[0]=r+i[0],u.apply(void 0,b(i))):r+t[0];try{s[e](i)}catch(e){console&&console.log&&console.log("[LaunchDarkly] Configured logger's "+n+" method threw an exception: "+e)}}}))},a=0;a<g.length;a++)o(a);return i}function he(e,n){return M({level:e,prefix:n})}function p(e){return e&&e.message?e.message:"string"==typeof e||e instanceof String?e:JSON.stringify(e)}function be(){return"LaunchDarkly client initialized"}function ke(){return"Be sure to call `identify` in the LaunchDarkly client: https://docs.launchdarkly.com/sdk/features/identify#javascript"}function fe(e){return'Custom event "'+e+'" does not exist'}function z(){return"Environment not found. Double check that you specified a valid environment/client-side ID."+m}function Ee(){return"No environment/client-side ID was specified."+m}function de(e){return"Error fetching flag settings: "+p(e)}function we(){return"Invalid data received from LaunchDarkly; connection may have been interrupted"}function De(){return"LaunchDarkly client was initialized with bootstrap data that did not include flag metadata. Events may not be sent correctly."+m}function Oe(){return"LaunchDarkly bootstrap data is not available because the back end could not read the flags."}function J(e,n){return n?'"'+e+'" is deprecated, please use "'+n+'"':'"'+e+'" is deprecated'}function Pe(){return"identify() has no effect here; it must be called on the main client instance"}function K(e){return'Ignoring unknown config option "'+e+'"'}function B(e,n,t){return'Config option "'+e+'" should be of type '+n+", got "+t+", using default value"}function $(e,n){return'Config option "'+e+'" should be a boolean, got '+n+", converting to boolean"}function H(e,n,t){return'Config option "'+e+'" was set to '+n+", changing to minimum value of "+t}function Se(){return"received ping message from stream"}function Ue(){return"received streaming update for all flags"}function Ie(e){return'received streaming update for flag "'+e+'"'}function je(e){return'received streaming update for flag "'+e+'" but ignored due to version check'}function Te(e){return'received streaming deletion for flag "'+e+'"'}function Re(e){return'received streaming deletion for flag "'+e+'" but ignored due to version check'}function Ae(e){return'enqueueing "'+e+'" event'}var m=" Please see https://docs.launchdarkly.com/sdk/client-side/javascript#initializing-the-client for instructions on SDK initialization.",G=function(){return"Exceeded event queue capacity. Increase capacity to avoid dropping events."},W=function(e){return'Expected application/json content type but got "'+e+'"'},ve=function(e){return"local storage is unavailable: "+p(e)},X=function(e){return"network error"+(e?" ("+e+")":"")},Q=function(){return"No user specified."+m},Y=function(){return"Invalid user specified."+m},Z=function(e,n,t){return"Received error "+e+(401===e?" (invalid SDK key)":"")+" for "+n+" - "+(A(e)?t:"giving up permanently")},Ce=function(){return"Cannot make HTTP requests in this environment."+m},Le=function(){return"Closing stream connection"},Ne=function(e){return"Opening stream connection to "+e},Fe=function(e,n){return"Error on stream connection: "+p(e)+", will continue retrying every "+n+" milliseconds."},xe=function(e){return"polling for feature flags at "+e},_e=function(e){return"sending "+e+" events"},Ve=function(e){return'Config option "'.concat(e,'" must only contain letters, numbers, ., _ or -.')},qe=Object.freeze({__proto__:null,clientInitialized:be,clientNotReady:function(){return"LaunchDarkly client is not ready"},eventCapacityExceeded:G,eventWithoutUser:ke,invalidContentType:W,invalidKey:function(){return"Event key must be a string"},localStorageUnavailable:ve,networkError:X,unknownCustomEventKey:fe,environmentNotFound:z,environmentNotSpecified:Ee,errorFetchingFlags:de,userNotSpecified:Q,invalidUser:Y,invalidData:we,bootstrapOldFormat:De,bootstrapInvalid:Oe,deprecated:J,httpErrorMessage:Z,httpUnavailable:Ce,identifyDisabled:Pe,streamClosing:Le,streamConnecting:Ne,streamError:Fe,unknownOption:K,wrongOptionType:B,wrongOptionTypeBoolean:$,optionBelowMinimum:H,debugPolling:xe,debugStreamPing:Se,debugStreamPut:Ue,debugStreamPatch:Ie,debugStreamPatchIgnored:je,debugStreamDelete:Te,debugStreamDeleteIgnored:Re,debugEnqueueingEvent:Ae,debugPostingEvents:_e,debugPostingDiagnosticEvent:function(e){return"sending diagnostic event ("+e.kind+")"},invalidTagValue:Ve}),Me={baseUrl:{default:"https://app.launchdarkly.com"},streamUrl:{default:"https://clientstream.launchdarkly.com"},eventsUrl:{default:"https://events.launchdarkly.com"},sendEvents:{default:!0},streaming:{type:"boolean"},sendLDHeaders:{default:!0},requestHeaderTransform:{type:"function"},inlineUsersInEvents:{default:!1},allowFrequentDuplicateEvents:{default:!1},sendEventsOnlyForVariation:{default:!1},useReport:{default:!1},evaluationReasons:{default:!1},eventCapacity:{default:100,minimum:1},flushInterval:{default:2e3,minimum:2e3},samplingInterval:{default:0,minimum:0},streamReconnectDelay:{default:1e3,minimum:0},allAttributesPrivate:{default:!1},privateAttributeNames:{default:[]},bootstrap:{type:"string|object"},diagnosticRecordingInterval:{default:9e5,minimum:2e3},diagnosticOptOut:{default:!1},wrapperName:{type:"string"},wrapperVersion:{type:"string"},stateProvider:{type:"object"},autoAliasingOptOut:{default:!1},application:{validator:function(e,n,t,r){var i={};t.id&&(i.id=Je("".concat(e,".id"),0,t.id,r));t.version&&(i.version=Je("".concat(e,".version"),0,t.version,r));return i}}},ze=/^(\w|\.|-)+$/;function Je(e,n,t,r){if("string"==typeof t&&t.match(ze))return t;r.warn(Ve(e))}function Ke(e,n,t,a){var u=ce({logger:{default:a}},Me,t),r={all_attributes_private:"allAttributesPrivate",private_attribute_names:"privateAttributeNames",samplingInterval:null,allowFrequentDuplicateEvents:void 0};function s(e){ae(function(){n&&n.maybeReportError(new k(e))})}var i,o,c,l,f,t=ce({},e||{});function d(e){return null===e?"any":void 0!==e?Array.isArray(e)?"array":"boolean"===(e=ne(e))||"string"===e||"number"===e||"function"===e?e:"object":void 0}return i=t,Object.keys(r).forEach(function(e){var n;void 0!==i[e]&&(n=r[e],a&&a.warn(J(e,n)),n&&(void 0===i[n]&&(i[n]=i[e]),delete i[e]))}),o=ce({},t),Object.keys(u).forEach(function(e){void 0!==o[e]&&null!==o[e]||(o[e]=u[e]&&u[e].default)}),l=ce({},c=t=o),Object.keys(c).forEach(function(e){var n,t,r,i,o=c[e];null!=o&&(void 0===(n=u[e])?s(K(e)):(t=n.type||d(n.default),(r=n.validator)?void 0!==(r=r(e,c,c[e],a))?l[e]=r:delete l[e]:"any"!==t&&(r=t.split("|"),i=d(o),r.indexOf(i)<0?"boolean"===t?(l[e]=!!o,s($(e,i))):(s(B(e,t,i)),l[e]=n.default):"number"===i&&void 0!==n.minimum&&o<n.minimum&&(s(H(e,o,n.minimum)),l[e]=n.minimum))))}),f=(t=l).logger,g.forEach(function(e){if("none"!==e&&(!f[e]||"function"!=typeof f[e]))throw new Error("Provided logger instance must support logger."+e+"(...) method")}),t}function Be(e){var n={};return e&&(e.application&&void 0!==e.application.id&&null!==e.application.id&&(n["application-id"]=[e.application.id]),e.application&&void 0!==e.application.version&&null!==e.application.id&&(n["application-version"]=[e.application.version])),n}function $e(e,n){var t;return n&&!n.sendLDHeaders?{}:(e={"X-LaunchDarkly-User-Agent":R(e)},n&&n.wrapperName&&(e["X-LaunchDarkly-Wrapper"]=n.wrapperVersion?n.wrapperName+"/"+n.wrapperVersion:n.wrapperName),t=Be(n),(n=Object.keys(t)).length&&(e["x-launchdarkly-tags"]=n.sort().flatMap(function(n){return Array.isArray(t[n])?t[n].sort().map(function(e){return"".concat(n,"/").concat(e)}):["".concat(n,"/").concat(t[n])]}).join(" ")),e)}function He(e,n){return n&&n.requestHeaderTransform?n.requestHeaderTransform(ee({},e)):e}var Ge=2e3;function We(u,e,s){var c="/a/"+e+".gif",l=ce({"Content-Type":"application/json"},$e(u,s)),f=u.httpFallbackPing,d={};return d.sendChunk=function(e,n,r,t){var i=JSON.stringify(e),o=r?null:v();function a(t){var e=r?l:ce({},l,{"X-LaunchDarkly-Event-Schema":"3","X-LaunchDarkly-Payload-ID":o});return u.httpRequest("POST",n,He(e,s),i).promise.then(function(e){var n;if(e)return 400<=e.status&&A(e.status)&&t?a(!1):(n={status:(e=e).status},(e=e.header("date"))&&(e=Date.parse(e))&&(n.serverTime=e),n)}).catch(function(){return t?a(!1):Promise.reject()})}return t?a(!0).catch(function(){}):(f&&f(n+c+"?d="+O(i)),Promise.resolve())},d.sendEvents=function(e,n,t){if(!u.httpRequest)return Promise.resolve();for(var r=u.httpAllowsPost(),i=r?[e]:T(Ge-n.length,e),o=[],a=0;a<i.length;a++)o.push(d.sendChunk(i[a],n,t,r));return Promise.all(o)},d}function Xe(e,n,t,r,i,o){var a,u,s,c,l,f,d,v,g=3<arguments.length&&void 0!==r?r:null,p=4<arguments.length&&void 0!==i?i:null,m={},y=(5<arguments.length&&void 0!==o?o:null)||We(e,t,n),h=C(n.eventsUrl,"/events/bulk/"+t),b=(u=a=0,s={},(r={}).summarizeEvent=function(e){var n,t;"feature"===e.kind&&(n=e.key+":"+(null!==e.variation&&void 0!==e.variation?e.variation:"")+":"+(null!==e.version&&void 0!==e.version?e.version:""),(t=s[n])?t.count=t.count+1:s[n]={count:1,key:e.key,variation:e.variation,version:e.version,value:e.value,default:e.default},(0===a||e.creationDate<a)&&(a=e.creationDate),e.creationDate>u&&(u=e.creationDate))},r.getSummary=function(){var e,n={},t=!0;for(e in s){var r=s[e],i=n[r.key],o=(i||(i={default:r.default,counters:[]},n[r.key]=i),{value:r.value,count:r.count});void 0!==r.variation&&null!==r.variation&&(o.variation=r.variation),r.version?o.version=r.version:o.unknown=!0,i.counters.push(o),t=!1}return t?null:{startDate:a,endDate:u,features:n}},r.clearSummary=function(){u=a=0,s={}},r),k=(i={},c=(o=n).allAttributesPrivate,l=o.privateAttributeNames||[],f={key:!0,custom:!0,anonymous:!0},d={key:!0,secondary:!0,ip:!0,country:!0,email:!0,firstName:!0,lastName:!0,avatar:!0,name:!0,anonymous:!0,custom:!0},i.filterUser=function(e){var n,i,t,r,o;return e?(n=e.privateAttributeNames||[],i=function(e){return!f[e]&&(c||-1!==n.indexOf(e)||-1!==l.indexOf(e))},t=(r=(o=function(t,r){return Object.keys(t).reduce(function(e,n){return r(n)&&(i(n)?e[1][n]=!0:e[0][n]=t[n]),e},[{},{}])})(e,function(e){return d[e]}))[0],r=r[1],e.custom&&(o=o(e.custom,function(){return 1}),t.custom=o[0],r=ce({},r,o[1])),(e=Object.keys(r)).length&&(e.sort(),t.privateAttrs=e),t):null},i),E=n.inlineUsersInEvents,w=n.samplingInterval,D=n.eventCapacity,O=n.flushInterval,P=n.logger,S=[],U=0,I=!1,j=!1;function T(){return 0===w||0===Math.floor(Math.random()*w)}function R(e){S.length<D?(S.push(e),j=!1):(j||(j=!0,P.warn(G())),g&&g.incrementDroppedEvents())}return m.enqueue=function(e){var n,t,r;I||(n=r=!1,b.summarizeEvent(e),"feature"===e.kind?T()&&(r=!!e.trackEvents,n=!!(t=e).debugEventsUntilDate&&(t.debugEventsUntilDate>U&&t.debugEventsUntilDate>(new Date).getTime())):r=T(),r&&R((r=ce({},t=e),"alias"!==t.kind&&(E||"identify"===t.kind?r.user=k.filterUser(t.user):(r.userKey=t.user.key,delete r.user),"feature"===t.kind&&(delete r.trackEvents,delete r.debugEventsUntilDate)),r)),n&&((r=ce({},e,{kind:"debug"})).user=k.filterUser(r.user),delete r.trackEvents,delete r.debugEventsUntilDate,R(r)))},m.flush=function(){var e,n;return I||(e=S,n=b.getSummary(),b.clearSummary(),n&&(n.kind="summary",e.push(n)),g&&g.setEventsInLastBatch(e.length),0===e.length)?Promise.resolve():(S=[],P.debug(_e(e.length)),y.sendEvents(e,h).then(function(e){e&&(e.serverTime&&(U=e.serverTime),A(e.status)||(I=!0),400<=e.status&&ae(function(){p.maybeReportError(new L(Z(e.status,"event posting","some events were dropped")))}))}))},m.start=function(){v=setTimeout(function e(){m.flush(),v=setTimeout(e,O)},O)},m.stop=function(){clearTimeout(v)},m}function Qe(n){var e={},i={};return e.on=function(e,n,t){i[e]=i[e]||[],i[e]=i[e].concat({handler:n,context:t})},e.off=function(e,n,t){if(i[e])for(var r=0;r<i[e].length;r++)i[e][r].handler===n&&i[e][r].context===t&&(i[e]=i[e].slice(0,r).concat(i[e].slice(r+1)))},e.emit=function(e){if(i[e])for(var n=i[e].slice(0),t=0;t<n.length;t++)n[t].handler.apply(n[t].context,Array.prototype.slice.call(arguments,1))},e.getEvents=function(){return Object.keys(i)},e.getEventListenerCount=function(e){return i[e]?i[e].length:0},e.maybeReportError=function(e){e&&(i["error"]?this.emit("error",e):(n||console).error(e.message))},e}var y="ready",Ye="initialized",Ze="failed";var en=function(i){var n=!1,t=!1,r=null,e=null,o=new Promise(function(n){i.on(y,function e(){i.off(y,e),n()})}).catch(function(){});return{getInitializationPromise:function(){if(!e){if(n)return Promise.resolve();if(t)return Promise.reject(r);e=new Promise(function(n,t){function r(e){i.off(Ze,r),t(e)}i.on(Ye,function e(){i.off(Ye,e),n()}),i.on(Ze,r)})}return e},getReadyPromise:function(){return o},signalSuccess:function(){n||t||(n=!0,i.emit(Ye),i.emit(y))},signalFailure:function(e){n||t||(t=!0,r=e,i.emit(Ze,e),i.emit(y)),i.maybeReportError(e)}}};function nn(n,t,r,i){var o={};function a(){var e="",n=i.getUser();return n&&(e=r||c(JSON.stringify(n))),"ld:"+t+":"+e}return o.loadFlags=function(){return n.get(a()).then(function(e){if(null==e)return null;try{var n,t=JSON.parse(e);return t&&(void 0===(n=t.$schema)||n<1?t=j(t):delete t.$schema),t}catch(e){return o.clearFlags().then(function(){return null})}})},o.saveFlags=function(e){e=ce({},e,{$schema:1});return n.set(a(),JSON.stringify(e))},o.clearFlags=function(){return n.clear(a())},o}function tn(r,n){function i(e){t||(t=!0,n.warn(ve(e)))}var e={},t=!1;return e.isEnabled=function(){return!!r},e.get=function(e){return new Promise(function(n){r?r.get(e).then(n).catch(function(e){i(e),n(void 0)}):n(void 0)})},e.set=function(e,t){return new Promise(function(n){r?r.set(e,t).then(function(){return n(!0)}).catch(function(e){i(e),n(!1)}):n(!1)})},e.clear=function(e){return new Promise(function(n){r?r.clear(e).then(function(){return n(!0)}).catch(function(e){i(e),n(!1)}):n(!1)})},e}var rn=3e5;function on(i,o,a,n){var u,s=o.streamUrl,c=o.logger,e={},l=C(s,"/eval/"+a),f=o.useReport,d=o.evaluationReasons,t=o.streamReconnectDelay,v=$e(i,o),g=!1,p=null,m=null,y=null,h=null,b=null;function k(e){g||(c.warn(Fe(e,t)),g=!0),D(!1),w(),E(t)}function E(e){m||(e?m=setTimeout(r,e):r())}function r(){m=null;var e,n="",t={headers:v,readTimeoutMillis:rn};if(i.eventSourceFactory){for(var r in null!=h&&(n="h="+h),f?i.eventSourceAllowsReport?(e=l,t.method="REPORT",t.headers["Content-Type"]="application/json",t.body=JSON.stringify(y)):(e=C(s,"/ping/"+a),n=""):e=l+"/"+O(JSON.stringify(y)),t.headers=He(t.headers,o),e=e+((n=d?n+(n?"&":"")+"withReasons=true":n)?"?":"")+n,w(),c.info(Ne(e)),u=(new Date).getTime(),p=i.eventSourceFactory(e,t),b)le(b,r)&&p.addEventListener(r,b[r]);p.onerror=k}}function w(){p&&(c.info(Le()),p.close(),p=null)}function D(e){u&&n&&n.recordStreamInit(u,!e,(new Date).getTime()-u),u=null}return e.connect=function(e,n,t){y=e,h=n,b={};for(var r in t||{})!function(n){b[n]=function(e){D(!(g=!1)),t[n]&&t[n](e)}}(r);E()},e.disconnect=function(){clearTimeout(m),m=null,w()},e.isConnected=function(){return!!(p&&i.eventSourceIsActive&&i.eventSourceIsActive(p))},e}var an="application/json";function un(d,v,o){var a=v.baseUrl,u=v.useReport,s=v.evaluationReasons,c=v.logger,e={},g={};function l(e,n){var t,r,i,o,a,u,s,c,l,f;return d.httpRequest?(t=n?"REPORT":"GET",r=$e(d,v),n&&(r["Content-Type"]=an),(i=g[e])||(o=function(){delete g[e]},(f={addPromise:function(n,e){a=n,u&&u(),u=e,n.then(function(e){a===n&&(s(e),o&&o())},function(e){a===n&&(c(e),o&&o())})}}).resultPromise=new Promise(function(e,n){s=e,c=n}),i=f,g[e]=i),f=(l=d.httpRequest(t,e,He(r,v),n)).promise.then(function(e){var n;return 200===e.status?e.header("content-type")&&e.header("content-type").substring(0,an.length)===an?JSON.parse(e.body):(n=W(e.header("content-type")||""),Promise.reject(new re(n))):Promise.reject(404===(n=e).status?new te(z()):new re(de(n.statusText||String(n.status))))},function(e){return Promise.reject(new re(X(e)))}),i.addPromise(f,function(){l.cancel&&l.cancel()}),i.resultPromise):new Promise(function(e,n){n(new re(Ce()))})}return e.fetchJSON=function(e){return l(C(a,e),null)},e.fetchFlagSettings=function(e,n){var t,r,i="";return u?(t=[a,"/sdk/evalx/",o,"/user"].join(""),r=JSON.stringify(e)):(e=O(JSON.stringify(e)),t=[a,"/sdk/evalx/",o,"/users/",e].join("")),n&&(i="h="+n),c.debug(xe(t=t+((i=s?i+(i?"&":"")+"withReasons=true":i)?"?":"")+i)),l(t,r)},e}var sn="ld:$anonUserId";function cn(t){var e={};return e.validateUser=function(e){var n;return e?null!==(n=ie(e)).key&&void 0!==n.key?(n.key=n.key.toString(),Promise.resolve(n)):n.anonymous?t.get(sn).then(function(e){return e?(n.key=e,n):(e=v(),n.key=e,t.set(sn,e).then(function(){return n}))}):Promise.reject(new i(Y())):Promise.reject(new i(Q()))},e}var ln=Object.freeze({__proto__:null,baseOptionDefs:Me,validate:Ke,getTags:Be}).baseOptionDefs,fn=N.appendUrlPath;var dn=function(e){var n={diagnosticId:v()};return e&&(n.sdkKeySuffix=6<e.length?e.substring(e.length-6):e),n},vn=function(e){var n,t,r,i;function o(e){n=e,r=t=0,i=[]}return o(e),{getProps:function(){return{dataSinceDate:n,droppedEvents:t,eventsInLastBatch:r,streamInits:i}},setProps:function(e){n=e.dataSinceDate,t=e.droppedEvents||0,r=e.eventsInLastBatch||0,i=e.streamInits||[]},incrementDroppedEvents:function(){t++},setEventsInLastBatch:function(e){r=e},recordStreamInit:function(e,n,t){i.push({timestamp:e,failed:n,durationMillis:t})},reset:o}},gn=function(n,r,e,t,i,o,a){var u,s,c=!!n.diagnosticUseCombinedEvent,l="ld:"+i+":$diagnostics",f=fn(o.eventsUrl,"/events/diagnostic/"+i),d=o.diagnosticRecordingInterval,v=e,g=!!o.streaming;function p(){return{sdk:function(){var e=ee({},n.diagnosticSdkData);o.wrapperName&&(e.wrapperName=o.wrapperName);o.wrapperVersion&&(e.wrapperVersion=o.wrapperVersion);return e}(),configuration:{customBaseURI:o.baseUrl!==ln.baseUrl.default,customStreamURI:o.streamUrl!==ln.streamUrl.default,customEventsURI:o.eventsUrl!==ln.eventsUrl.default,eventsCapacity:o.eventCapacity,eventsFlushIntervalMillis:o.flushInterval,reconnectTimeMillis:o.streamReconnectDelay,streamingDisabled:!g,allAttributesPrivate:!!o.allAttributesPrivate,inlineUsersInEvents:!!o.inlineUsersInEvents,diagnosticRecordingIntervalMillis:o.diagnosticRecordingInterval,usingSecureMode:!!o.hash,bootstrapMode:!!o.bootstrap,fetchGoalsDisabled:!o.fetchGoals,sendEventsOnlyForVariation:!!o.sendEventsOnlyForVariation,autoAliasingOptOut:!!o.autoAliasingOptOut},platform:n.diagnosticPlatformData}}function m(e){o.logger&&o.logger.debug(qe.debugPostingDiagnosticEvent(e)),t.sendEvents(e,f,!0).then(function(){}).catch(function(){})}function y(){var e,n;m((n=(new Date).getTime(),e=ee({kind:c?"diagnostic-combined":"diagnostic",id:a,creationDate:n},v.getProps()),c&&(e=ee(ee({},e),p())),v.reset(n),e)),s=setTimeout(y,d),u=(new Date).getTime(),c&&r.isEnabled()&&(n=ee({},v.getProps()),r.set(l,JSON.stringify(n)))}return(i={}).start=function(){var t;c?(t=function(e){var n;e?(e=(u||0)+d)<=(n=(new Date).getTime())?y():s=setTimeout(y,e-n):0===Math.floor(4*Math.random())?y():s=setTimeout(y,d)},r.isEnabled()?r.get(l).then(function(e){if(e)try{var n=JSON.parse(e);v.setProps(n),u=n.dataSinceDate}catch(e){}t(!0)}).catch(function(){t(!1)}):t(!1)):(m(ee({kind:"diagnostic-init",id:a,creationDate:v.getProps().dataSinceDate},p())),s=setTimeout(y,d))},i.stop=function(){s&&clearTimeout(s)},i.setStreaming=function(e){g=e},i},ge="change",pn="internal-change";e.commonBasicLogger=M,e.createConsoleLogger=he,e.errors=E,e.initialize=function(F,x,e,i,n){var t,o,r,a,u,s,_,c,l,f=function(){if(e&&e.logger)return e.logger;return n&&n.logger&&n.logger.default||he("warn")}(),d=Qe(f),v=en(d),g=Ke(e,d,n,f),p=g.sendEvents,m=F,y=g.hash,h=tn(i.localStorage,f),b=We(i,m,g),k=g.sendEvents&&!g.diagnosticOptOut,V=k?dn(m):null,E=k?vn((new Date).getTime()):null,w=k?gn(i,h,E,b,m,g,V):null,q=on(i,g,m,E),D=g.eventProcessor||Xe(i,g,m,E,d,b),O=un(i,g,m),P={},S=g.streaming,M=!1,U=!1,z=!0,I=g.stateProvider,j=(a=function(e,n){(function(e){I||e&&R({kind:"identify",key:e.key,user:e,creationDate:(new Date).getTime()})})(e),!g.autoAliasingOptOut&&n&&n.anonymous&&e&&!e.anonymous&&$(e,n)},k={setUser:function(e){var n=u&&ie(u);(u=ye(e))&&a&&a(ie(u),n)},getUser:function(){return u?ie(u):null}},(V=null)&&k.setUser(V),k),J=cn(h),T=h.isEnabled()?new nn(h,m,y,j):null;function R(e){if(m&&!(I&&I.enqueueEvent&&I.enqueueEvent(e))){if("alias"!==e.kind){if(!e.user)return void(z&&(f.warn(ke()),z=!1));z=!1}!p||U||i.isDoNotTrack()||(f.debug(Ae(e.kind)),D.enqueue(e))}}function K(e,n,t,r){var i=j.getUser(),o=new Date,t={kind:"feature",key:e,user:i,value:n?n.value:null,variation:n?n.variationIndex:null,default:t,creationDate:o.getTime()},o=(i&&i.anonymous&&(t.contextKind=C(i)),P[e]);o&&(t.version=o.flagVersion||o.version,t.trackEvents=o.trackEvents,t.debugEventsUntilDate=o.debugEventsUntilDate),(r||o&&o.trackReason)&&n&&(t.reason=n.reason),R(t)}function B(e,n,t,r){var i,o;return P&&le(P,e)&&P[e]&&!P[e].deleted?(o=A(i=P[e]),null!==i.value&&void 0!==i.value||(o.value=n)):o={value:n,variationIndex:null,reason:{kind:"ERROR",errorKind:"FLAG_NOT_FOUND"}},t&&K(e,o,n,r),o}function A(e){return{value:e.value,variationIndex:void 0===e.variation?null:e.variation,reason:e.reason||null}}function C(e){return e.anonymous?"anonymousUser":"user"}function $(e,n){I||e&&n&&R({kind:"alias",key:e.key,contextKind:C(e),previousKey:n.key,previousContextKind:C(n),creationDate:(new Date).getTime()})}function H(){var i;o=!0,j.getUser()&&(i=function(e){try{return JSON.parse(e)}catch(e){d.maybeReportError(new me(we()))}},q.connect(j.getUser(),y,{ping:function(){f.debug(Se());var n=j.getUser();O.fetchFlagSettings(n,y).then(function(e){oe(n,j.getUser())&&L(e||{})}).catch(function(e){d.maybeReportError(new re(de(e)))})},put:function(e){e=i(e.data);e&&(f.debug(Ue()),L(e))},patch:function(e){var n,t,r,e=i(e.data);e&&(!(n=P[e.key])||!n.version||!e.version||n.version<e.version?(f.debug(Ie(e.key)),t={},delete(r=ce({},e)).key,r=A(P[e.key]=r),t[e.key]=n?{previous:n.value,current:r}:{current:r},W(t)):f.debug(je(e.key)))},delete:function(e){var n,e=i(e.data);e&&(!P[e.key]||P[e.key].version<e.version?(f.debug(Te(e.key)),n={},P[e.key]&&!P[e.key].deleted&&(n[e.key]={previous:P[e.key].value}),P[e.key]={version:e.version,deleted:!0},W(n)):f.debug(Re(e.key)))}}))}function G(){o&&(q.disconnect(),o=!1)}function L(e){var n,t,r={};if(!e)return Promise.resolve();for(n in P)le(P,n)&&P[n]&&(e[n]&&!oe(e[n].value,P[n].value)?r[n]={previous:P[n].value,current:A(e[n])}:e[n]&&!e[n].deleted||(r[n]={previous:P[n].value}));for(t in e)le(e,t)&&e[t]&&(!P[t]||P[t].deleted)&&(r[t]={current:A(e[t])});return P=ee({},e),W(r).catch(function(){})}function W(i){var o,e=Object.keys(i);return 0<e.length&&(o={},e.forEach(function(e){var n=i[e].current,t=n?n.value:void 0,r=i[e].previous;d.emit(ge+":"+e,t,r),o[e]=n?{current:t,previous:r}:{previous:r}}),d.emit(ge,o),d.emit(pn,P),g.sendEventsOnlyForVariation||I||e.forEach(function(e){K(e,i[e].current)})),t&&T?T.saveFlags(P):Promise.resolve()}function X(){var e=S||r&&void 0===S;e&&!o?H():!e&&o&&G(),w&&w.setStreaming(e)}function Q(e){return e===ge||e.substr(0,ge.length+1)===ge+":"}function Y(e){m=e.environment,j.setUser(e.user),P=ee({},e.flags),ae(N)}function N(){f.info(be()),M=!0,X(),v.signalSuccess()}function Z(e){v.signalFailure(e)}return"string"==typeof g.bootstrap&&"LOCALSTORAGE"===g.bootstrap.toUpperCase()&&(T?t=!0:f.warn(ve())),"object"===ne(g.bootstrap)&&(s=g.bootstrap,E=Object.keys(s),!(c=s[_="$flagsState"])&&E.length&&f.warn(De()),!1===s.$valid&&f.warn(Oe()),l={},E.forEach(function(e){var n;e!==_&&"$valid"!==e&&(n={value:s[e]},c&&c[e]?n=ce(n,c[e]):n.version=0,l[e]=n)}),P=l),I?((b=I.getInitialState())?Y(b):I.on("init",Y),I.on("update",function(e){e.user&&j.setUser(e.user);e.flags&&L(e.flags)})):(F?J.validateUser(x).then(function(e){return j.setUser(e),"object"===ne(g.bootstrap)?N():t?T.loadFlags().then(function(e){return null==e?(P={},O.fetchFlagSettings(j.getUser(),y).then(function(e){return L(e||{})}).then(N).catch(function(e){Z(new re(de(e)))})):(P=e,ae(N),O.fetchFlagSettings(j.getUser(),y).then(L).catch(function(e){return d.maybeReportError(e)}))}):O.fetchFlagSettings(j.getUser(),y).then(function(e){P=e||{},N()}).catch(function(e){P={},Z(e)})}):Promise.reject(new te(Ee()))).catch(Z),{client:{waitForInitialization:function(){return v.getInitializationPromise()},waitUntilReady:function(){return v.getReadyPromise()},identify:function(e,r,n){return U?ue(Promise.resolve({}),n):I?(f.warn(Pe()),ue(Promise.resolve(se(P)),n)):ue((t&&T?T.clearFlags():Promise.resolve()).then(function(){return J.validateUser(e)}).then(function(t){return O.fetchFlagSettings(t,r).then(function(e){var n=se(e);return j.setUser(t),y=r,e?L(e).then(function(){return n}):n})}).then(function(e){return o&&H(),e}).catch(function(e){return d.maybeReportError(e),Promise.reject(e)}),n)},getUser:function(){return j.getUser()},variation:function(e,n){return B(e,n,!0,!1).value},variationDetail:function(e,n){return B(e,n,!0,!0)},track:function(e,n,t){var r;"string"!=typeof e?d.maybeReportError(new pe(fe(e))):(i.customEventFilter&&!i.customEventFilter(e)&&f.warn(fe(e)),r={kind:"custom",key:e,user:e=j.getUser(),url:i.getCurrentUrl(),creationDate:(new Date).getTime()},e&&e.anonymous&&(r.contextKind=C(e)),null!=n&&(r.data=n),null!=t&&(r.metricValue=t),R(r))},alias:$,on:function(e,n,t){Q(e)?(r=!0,M&&X(),d.on(e,n,t)):d.on.apply(d,arguments)},off:function(e){var n;d.off.apply(d,arguments),Q(e)&&(n=!1,d.getEvents().forEach(function(e){Q(e)&&0<d.getEventListenerCount(e)&&(n=!0)}),n||(r=!1,o&&void 0===S&&G()))},setStreaming:function(e){(e=null===e?void 0:e)!==S&&(S=e,X())},flush:function(e){return ue(p?D.flush():Promise.resolve(),e)},allFlags:function(){var e={};if(P)for(var n in P)le(P,n)&&!P[n].deleted&&(e[n]=B(n,null,!g.sendEventsOnlyForVariation).value);return e},close:function(e){var n;return U?ue(Promise.resolve(),e):(n=function(){U=!0,P={}},ue(Promise.resolve().then(function(){if(G(),w&&w.stop(),p)return D.stop(),D.flush()}).then(n).catch(n),e))}},options:g,emitter:d,ident:j,logger:f,requestor:O,start:function(){p&&(w&&w.start(),D.start())},enqueueEvent:R,getFlagsInternal:function(){return P},getEnvironmentId:function(){return m},internalChangeEventName:pn}},e.messages=qe,e.utils=N,e.version="3.7.0",Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ldclient-common.min.js.map
}(globalRequire.define));