/*!
 * widgets
 * @version: 9.0.017.18
 * @license: Genesys Telecom Labs
 */
widgetsJsonpFunction([17],{"./node_modules/cometd/cometd.js":function(e,t,n){!function(t,n){e.exports=function(){function e(){var e={};self.onmessage=function(t){var n=t.data,r=e[n.id];switch(n.type){case"setTimeout":e[n.id]=self.setTimeout(function(){delete e[n.id],self.postMessage({id:n.id})},n.delay);break;case"clearTimeout":delete e[n.id],r&&self.clearTimeout(r);break;default:throw"Unknown command "+n.type}}}var t=function(){var e=0,t={};this.register=function(n){var r=++e;return t[r]=n,r},this.unregister=function(e){var n=t[e];return delete t[e],n},this.setTimeout=function(e,t){return window.setTimeout(e,t)},this.clearTimeout=function(e){window.clearTimeout(e)}},n={isString:function(e){return void 0!==e&&null!==e&&("string"==typeof e||e instanceof String)},isArray:function(e){return void 0!==e&&null!==e&&e instanceof Array},inArray:function(e,t){for(var n=0;n<t.length;++n)if(e===t[n])return n;return-1}},r=function(){var e=[],t={};this.getTransportTypes=function(){return e.slice(0)},this.findTransportTypes=function(n,r,s){for(var i=[],a=0;a<e.length;++a){var o=e[a];!0===t[o].accept(n,r,s)&&i.push(o)}return i},this.negotiateTransport=function(n,r,s,i){for(var a=0;a<e.length;++a)for(var o=e[a],c=0;c<n.length;++c)if(o===n[c]){var u=t[o];if(!0===u.accept(r,s,i))return u}return null},this.add=function(n,r,s){for(var i=!1,a=0;a<e.length;++a)if(e[a]===n){i=!0;break}return i||("number"!=typeof s?e.push(n):e.splice(s,0,n),t[n]=r),!i},this.find=function(n){for(var r=0;r<e.length;++r)if(e[r]===n)return t[n];return null},this.remove=function(n){for(var r=0;r<e.length;++r)if(e[r]===n){e.splice(r,1);var s=t[n];return delete t[n],s}return null},this.clear=function(){e=[],t={}},this.reset=function(n){for(var r=0;r<e.length;++r)t[e[r]].reset(n)}},s=function(){var e,t,r;this.registered=function(n,r){e=n,t=r},this.unregistered=function(){e=null,t=null},this._debug=function(){t._debug.apply(t,arguments)},this._mixin=function(){return t._mixin.apply(t,arguments)},this.getConfiguration=function(){return t.getConfiguration()},this.getAdvice=function(){return t.getAdvice()},this.setTimeout=function(e,n){return t.setTimeout(e,n)},this.clearTimeout=function(e){t.clearTimeout(e)},this.convertToMessages=function(e){if(n.isString(e))try{return JSON.parse(e)}catch(t){throw this._debug("Could not convert to JSON the following string",'"'+e+'"'),t}if(n.isArray(e))return e;if(void 0===e||null===e)return[];if(e instanceof Object)return[e];throw"Conversion Error "+e+", typeof "+typeof e},this.accept=function(e,t,n){throw"Abstract"},this.getType=function(){return e},this.getURL=function(){return r},this.setURL=function(e){r=e},this.send=function(e,t){throw"Abstract"},this.reset=function(t){this._debug("Transport",e,"reset",t?"initial":"retry")},this.abort=function(){this._debug("Transport",e,"aborted")},this.toString=function(){return this.getType()}};s.derive=function(e){function t(){}return t.prototype=e,new t};var i=function(){function e(e){for(;p.length>0;){var t=p[0],n=t[0],r=t[1];if(n.url!==e.url||n.sync!==e.sync)break;p.shift(),e.messages=e.messages.concat(n.messages),this._debug("Coalesced",n.messages.length,"messages from request",r.id)}}function t(e,t){if(this.transportSend(e,t),t.expired=!1,!e.sync){var n=this.getConfiguration().maxNetworkDelay,r=n;!0===t.metaConnect&&(r+=this.getAdvice().timeout),this._debug("Transport",this.getType(),"waiting at most",r,"ms for the response, maxNetworkDelay",n);var s=this;t.timeout=this.setTimeout(function(){t.expired=!0;var n="Request "+t.id+" of transport "+s.getType()+" exceeded "+r+" ms max network delay",i={reason:n},a=t.xhr;i.httpCode=s.xhrStatus(a),s.abortXHR(a),s._debug(n),s.complete(t,!1,t.metaConnect),e.onFailure(a,e.messages,i)},r)}}function r(e){var n=++d,r={id:n,metaConnect:!1,envelope:e};f.length<this.getConfiguration().maxConnections-1?(f.push(r),t.call(this,e,r)):(this._debug("Transport",this.getType(),"queueing request",n,"envelope",e),p.push([e,r]))}function i(e){var t=e.id;if(this._debug("Transport",this.getType(),"/meta/connect complete, request",t),null!==l&&l.id!==t)throw"/meta/connect request mismatch, completing request "+t;l=null}function a(t,s){var i=n.inArray(t,f);if(i>=0&&f.splice(i,1),p.length>0){var a=p.shift(),o=a[0],c=a[1];if(this._debug("Transport dequeued request",c.id),s)this.getConfiguration().autoBatch&&e.call(this,o),r.call(this,o),this._debug("Transport completed request",t.id,o);else{var u=this;this.setTimeout(function(){u.complete(c,!1,c.metaConnect);var e={reason:"Previous request failed"},t=c.xhr;e.httpCode=u.xhrStatus(t),o.onFailure(t,o.messages,e)},0)}}}function o(e){if(null!==l)throw"Concurrent /meta/connect requests not allowed, request id="+l.id+" not yet completed";var n=++d;this._debug("Transport",this.getType(),"/meta/connect send, request",n,"envelope",e);var r={id:n,metaConnect:!0,envelope:e};t.call(this,e,r),l=r}var c=new s,u=s.derive(c),d=0,l=null,f=[],p=[];return u.complete=function(e,t,n){n?i.call(this,e):a.call(this,e,t)},u.transportSend=function(e,t){throw"Abstract"},u.transportSuccess=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!0,t.metaConnect),n&&n.length>0?e.onSuccess(n):e.onFailure(t.xhr,e.messages,{httpCode:204}))},u.transportFailure=function(e,t,n){t.expired||(this.clearTimeout(t.timeout),this.complete(t,!1,t.metaConnect),e.onFailure(t.xhr,e.messages,n))},u.send=function(e,t){t?o.call(this,e):r.call(this,e)},u.abort=function(){c.abort();for(var e=0;e<f.length;++e){var t=f[e];t&&(this._debug("Aborting request",t),this.abortXHR(t.xhr)||this.transportFailure(t.envelope,t,{reason:"abort"}))}var n=l;n&&(this._debug("Aborting /meta/connect request",n),this.abortXHR(n.xhr)||this.transportFailure(n.envelope,n,{reason:"abort"})),this.reset(!0)},u.reset=function(e){c.reset(e),l=null,f=[],p=[]},u.abortXHR=function(e){if(e)try{var t=e.readyState;return e.abort(),t!==window.XMLHttpRequest.UNSENT}catch(e){this._debug(e)}return!1},u.xhrStatus=function(e){if(e)try{return e.status}catch(e){this._debug(e)}return-1},u},a=function(){function e(e){try{e.context=n.context}catch(e){this._debug("Could not copy transport context into XHR",e)}}var t=new i,n=s.derive(t),r=!0;return n.accept=function(e,t,n){return r||!t},n.newXMLHttpRequest=function(){return new window.XMLHttpRequest},n.xhrSend=function(t){var r=n.newXMLHttpRequest();e(r),r.withCredentials=!0,r.open("POST",t.url,!0!==t.sync);var s=t.headers;if(s)for(var i in s)s.hasOwnProperty(i)&&r.setRequestHeader(i,s[i]);return r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.onload=function(){200===r.status?t.onSuccess(r.responseText):t.onError(r.statusText)},r.onabort=r.onerror=function(){t.onError(r.statusText)},r.send(t.body),r},n.transportSend=function(e,t){this._debug("Transport",this.getType(),"sending request",t.id,"envelope",e);var n=this;try{var s=!0;t.xhr=this.xhrSend({transport:this,url:e.url,sync:e.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(e.messages),onSuccess:function(s){n._debug("Transport",n.getType(),"received response",s);var i=!1;try{var a=n.convertToMessages(s);0===a.length?(r=!1,n.transportFailure(e,t,{httpCode:204})):(i=!0,n.transportSuccess(e,t,a))}catch(s){if(n._debug(s),!i){r=!1;var o={exception:s};o.httpCode=n.xhrStatus(t.xhr),n.transportFailure(e,t,o)}}},onError:function(i,a){n._debug("Transport",n.getType(),"received error",i,a),r=!1;var o={reason:i,exception:a};o.httpCode=n.xhrStatus(t.xhr),s?n.setTimeout(function(){n.transportFailure(e,t,o)},0):n.transportFailure(e,t,o)}}),s=!1}catch(s){r=!1,this.setTimeout(function(){n.transportFailure(e,t,{exception:s})},0)}},n.reset=function(e){t.reset(e),r=!0},n},o=function(){function e(e,t,n){var r=this;return function(){r.transportFailure(e,t,"error",n)}}var t=new i,n=s.derive(t),r=0;return n.accept=function(e,t,n){return!0},n.jsonpSend=function(e){var t=document.getElementsByTagName("head")[0],n=document.createElement("script"),s="_cometd_jsonp_"+r++;window[s]=function(r){t.removeChild(n),delete window[s],e.onSuccess(r)};var i=e.url;i+=i.indexOf("?")<0?"?":"&",i+="jsonp="+s,i+="&message="+encodeURIComponent(e.body),n.src=i,n.async=!0!==e.sync,n.type="application/javascript",n.onerror=function(t){e.onError("jsonp "+t.type)},t.appendChild(n)},n.transportSend=function(t,n){for(var r=this,s=0,i=t.messages.length,a=[];i>0;){var o=JSON.stringify(t.messages.slice(s,s+i)),c=t.url.length+encodeURI(o).length,u=this.getConfiguration().maxURILength;if(c>u){if(1===i){var d="Bayeux message too big ("+c+" bytes, max is "+u+") for transport "+this.getType();return void this.setTimeout(e.call(this,t,n,d),0)}--i}else a.push(i),s+=i,i=t.messages.length-s}var l=t;if(a.length>1){var f=0,p=a[0];this._debug("Transport",this.getType(),"split",t.messages.length,"messages into",a.join(" + ")),l=this._mixin(!1,{},t),l.messages=t.messages.slice(f,p),l.onSuccess=t.onSuccess,l.onFailure=t.onFailure;for(var g=1;g<a.length;++g){var h=this._mixin(!1,{},t);f=p,p+=a[g],h.messages=t.messages.slice(f,p),h.onSuccess=t.onSuccess,h.onFailure=t.onFailure,this.send(h,n.metaConnect)}}this._debug("Transport",this.getType(),"sending request",n.id,"envelope",l);try{var m=!0;this.jsonpSend({transport:this,url:l.url,sync:l.sync,headers:this.getConfiguration().requestHeaders,body:JSON.stringify(l.messages),onSuccess:function(e){var t=!1;try{var s=r.convertToMessages(e);0===s.length?r.transportFailure(l,n,{httpCode:204}):(t=!0,r.transportSuccess(l,n,s))}catch(e){r._debug(e),t||r.transportFailure(l,n,{exception:e})}},onError:function(e,t){var s={reason:e,exception:t};m?r.setTimeout(function(){r.transportFailure(l,n,s)},0):r.transportFailure(l,n,s)}}),m=!1}catch(e){this.setTimeout(function(){r.transportFailure(l,n,{exception:e})},0)}},n},c=function(){function e(e,t){e&&(this.webSocketClose(e,t.code,t.reason),this.onClose(e,t))}function t(e){return e===h||e===g}function r(e,t,n){for(var r=[],s=0;s<t.messages.length;++s){var i=t.messages[s];i.id&&r.push(i.id)}e.envelopes[r.join(",")]=[t,n],this._debug("Transport",this.getType(),"stored envelope, envelopes",e.envelopes)}function i(n){if(!h){var r=c.getURL().replace(/^http/,"ws");this._debug("Transport",this.getType(),"connecting to URL",r);try{var s=c.getConfiguration().protocol;n.webSocket=s?new window.WebSocket(r,s):new window.WebSocket(r),h=n}catch(e){throw l=!1,this._debug("Exception while creating WebSocket object",e),e}p=!1!==c.getConfiguration().stickyReconnect;var i=this,a=c.getConfiguration().connectTimeout;a>0&&(n.connectTimer=this.setTimeout(function(){c._debug("Transport",i.getType(),"timed out while connecting to URL",r,":",a,"ms"),e.call(i,n,{code:1e3,reason:"Connect Timeout"})},a));var o=function(){c._debug("WebSocket onopen",n),n.connectTimer&&i.clearTimeout(n.connectTimer),t(n)?(h=null,g=n,f=!0,i.onOpen(n)):(c._warn("Closing extra WebSocket connection",this,"active connection",g),e.call(i,n,{code:1e3,reason:"Extra Connection"}))},u=function(e){e=e||{code:1e3},c._debug("WebSocket onclose",n,e,"connecting",h,"current",g),n.connectTimer&&i.clearTimeout(n.connectTimer),i.onClose(n,e)},d=function(e){c._debug("WebSocket onmessage",e,n),i.onMessage(n,e)};n.webSocket.onopen=o,n.webSocket.onclose=u,n.webSocket.onerror=function(){u({code:1e3,reason:"Error"})},n.webSocket.onmessage=d,this._debug("Transport",this.getType(),"configured callbacks on",n)}}function a(t,n,r){var s=JSON.stringify(n.messages);t.webSocket.send(s),this._debug("Transport",this.getType(),"sent",n,"/meta/connect =",r);var i=this.getConfiguration().maxNetworkDelay,a=i;r&&(a+=this.getAdvice().timeout,m=!0);for(var o=this,u=[],d=0;d<n.messages.length;++d)!function(){var r=n.messages[d];r.id&&(u.push(r.id),t.timeouts[r.id]=o.setTimeout(function(){c._debug("Transport",o.getType(),"timing out message",r.id,"after",a,"on",t),e.call(o,t,{code:1e3,reason:"Message Timeout"})},a))}();this._debug("Transport",this.getType(),"waiting at most",a,"ms for messages",u,"maxNetworkDelay",i,", timeouts:",t.timeouts)}function o(t,n,s){try{null===t?(t=h||{envelopes:{},timeouts:{}},r.call(this,t,n,s),i.call(this,t)):(r.call(this,t,n,s),a.call(this,t,n,s))}catch(n){var o=this;this.setTimeout(function(){e.call(o,t,{code:1e3,reason:"Exception",exception:n})},0)}}var c,u=new s,d=s.derive(u),l=!0,f=!1,p=!0,g=null,h=null,m=!1,v=null;return d.reset=function(e){u.reset(e),l=!0,e&&(f=!1),p=!0,g=null,h=null,m=!1},d._notifySuccess=function(e,t){e.call(this,t)},d._notifyFailure=function(e,t,n,r){e.call(this,t,n,r)},d.onOpen=function(e){var t=e.envelopes;this._debug("Transport",this.getType(),"opened",e,"pending messages",t);for(var n in t)if(t.hasOwnProperty(n)){var r=t[n],s=r[0],i=r[1];v=s.onSuccess,a.call(this,e,s,i)}},d.onMessage=function(e,t){this._debug("Transport",this.getType(),"received websocket message",t,e);for(var r=!1,s=this.convertToMessages(t.data),i=[],a=0;a<s.length;++a){var o=s[a];if((/^\/meta\//.test(o.channel)||void 0===o.data)&&o.id){i.push(o.id);var c=e.timeouts[o.id];c&&(this.clearTimeout(c),delete e.timeouts[o.id],this._debug("Transport",this.getType(),"removed timeout for message",o.id,", timeouts",e.timeouts))}"/meta/connect"===o.channel&&(m=!1),"/meta/disconnect"!==o.channel||m||(r=!0)}for(var u=!1,d=e.envelopes,l=0;l<i.length;++l){var f=i[l];for(var p in d)if(d.hasOwnProperty(p)){var g=p.split(","),h=n.inArray(f,g);if(h>=0){u=!0,g.splice(h,1);var y=d[p][0],b=d[p][1];delete d[p],g.length>0&&(d[g.join(",")]=[y,b]);break}}}u&&this._debug("Transport",this.getType(),"removed envelope, envelopes",d),this._notifySuccess(v,s),r&&this.webSocketClose(e,1e3,"Disconnect")},d.onClose=function(e,n){this._debug("Transport",this.getType(),"closed",e,n),t(e)&&(l=p&&f,h=null,g=null);var r=e.timeouts;e.timeouts={};for(var s in r)r.hasOwnProperty(s)&&this.clearTimeout(r[s]);var i=e.envelopes;e.envelopes={};for(var a in i)if(i.hasOwnProperty(a)){var o=i[a][0],c=i[a][1];c&&(m=!1);var u={websocketCode:n.code,reason:n.reason};n.exception&&(u.exception=n.exception),this._notifyFailure(o.onFailure,e,o.messages,u)}},d.registered=function(e,t){u.registered(e,t),c=t},d.accept=function(e,t,n){return this._debug("Transport",this.getType(),"accept, supported:",l),l&&!!window.WebSocket&&!1!==c.websocketEnabled},d.send=function(e,t){this._debug("Transport",this.getType(),"sending",e,"/meta/connect =",t),o.call(this,g,e,t)},d.webSocketClose=function(e,t,n){try{e.webSocket&&e.webSocket.close(t,n)}catch(e){this._debug(e)}},d.abort=function(){u.abort(),e.call(this,g,{code:1e3,reason:"Abort"}),this.reset(!0)},d},u=function(s){function i(e,t){try{return e[t]}catch(e){return}}function u(e){return n.isString(e)}function d(e){return void 0!==e&&null!==e&&"function"==typeof e}function l(e,t){for(var n="";--t>0&&!(e>=Math.pow(10,t));)n+="0";return n+=e}function f(e,t){if(window.console){var n=window.console[e];if(d(n)){var r=new Date;[].splice.call(t,0,0,l(r.getHours(),2)+":"+l(r.getMinutes(),2)+":"+l(r.getSeconds(),2)+"."+l(r.getMilliseconds(),3)),n.apply(window.console,t)}}}function p(e){return new RegExp("(^https?://)?(((\\[[^\\]]+])|([^:/?#]+))(:(\\d+))?)?([^?#]*)(.*)?").exec(e)}function g(t){be._debug("Configuring cometd object with",t),u(t)&&(t={url:t}),t||(t={}),Be=be._mixin(!1,Be,t);var n=be.getURL();if(!n)throw"Missing required configuration parameter 'url' specifying the Bayeux server URL";var r=p(n),s=r[2],i=r[8],a=r[9];if(we=be._isCrossDomain(s),Be.appendMessageTypeToURL)if(void 0!==a&&a.length>0)be._info("Appending message type to URI "+i+a+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Be.appendMessageTypeToURL=!1;else{var o=i.split("/"),c=o.length-1;i.match(/\/$/)&&(c-=1),o[c].indexOf(".")>=0&&(be._info("Appending message type to URI "+i+" is not supported, disabling 'appendMessageTypeToURL' configuration"),Be.appendMessageTypeToURL=!1)}if(window.Worker&&window.Blob&&window.URL&&Be.useWorkerScheduler){var d=e.toString();d=d.substring(d.indexOf("{")+1,d.lastIndexOf("}"));var l=new window.Blob([d],{type:"application/json"}),f=window.URL.createObjectURL(l),g=new window.Worker(f);ye.setTimeout=function(e,t){var n=ye.register(e);return g.postMessage({id:n,type:"setTimeout",delay:t}),n},ye.clearTimeout=function(e){ye.unregister(e),g.postMessage({id:e,type:"clearTimeout"})},g.onmessage=function(e){var t=e.data.id,n=ye.unregister(t);n&&n()}}}function h(e){if(e){var t=Re[e.channel];t&&t[e.id]&&(delete t[e.id],be._debug("Removed",e.listener?"listener":"subscription",e))}}function m(e){e&&!e.listener&&h(e)}function v(){for(var e in Re)if(Re.hasOwnProperty(e)){var t=Re[e];if(t)for(var n in t)t.hasOwnProperty(n)&&m(t[n])}}function y(e){ke!==e&&(be._debug("Status",ke,"->",e),ke=e)}function b(){return"disconnecting"===ke||"disconnected"===ke}function T(){return""+ ++Ce}function w(e,t,n,r,s){try{return t.call(e,r)}catch(e){var i=be.onExtensionException;if(d(i)){be._debug("Invoking extension exception handler",n,e);try{i.call(be,e,n,s,r)}catch(e){be._info("Exception during execution of extension exception handler",n,e)}}else be._info("Exception during execution of extension",n,e);return r}}function x(e){for(var t=0;t<Pe.length&&void 0!==e&&null!==e;++t){var n=Pe[t],r=n.extension.incoming;if(d(r)){var s=w(n.extension,r,n.name,e,!1);e=void 0===s?e:s}}return e}function k(e){for(var t=Pe.length-1;t>=0&&void 0!==e&&null!==e;--t){var n=Pe[t],r=n.extension.outgoing;if(d(r)){var s=w(n.extension,r,n.name,e,!0);e=void 0===s?e:s}}return e}function C(e,t){var n=Re[e];if(n)for(var r in n)if(n.hasOwnProperty(r)){var s=n[r];if(s)try{s.callback.call(s.scope,t)}catch(e){var i=be.onListenerException;if(d(i)){be._debug("Invoking listener exception handler",s,e);try{i.call(be,e,s,s.listener,t)}catch(e){be._info("Exception during execution of listener exception handler",s,e)}}else be._info("Exception during execution of listener",s,t,e)}}}function S(e,t){C(e,t);for(var n=e.split("/"),r=n.length-1,s=r;s>0;--s){var i=n.slice(0,s).join("/")+"/*";s===r&&C(i,t),i+="*",C(i,t)}}function _(){null!==Ae&&be.clearTimeout(Ae),Ae=null}function I(e,t){_();var n=Le.interval+t;be._debug("Function scheduled in",n,"ms, interval =",Le.interval,"backoff =",Oe,e),Ae=be.setTimeout(e,n)}function D(e,t,n){for(var r=0;r<e.length;++r){var s=e[r],i=s.id;Se&&(s.clientId=Se),s=k(s),void 0!==s&&null!==s?(s.id=i,e[r]=s):(delete Me[i],e.splice(r--,1))}if(0!==e.length){t&&(Ke=e[0]);var a=be.getURL();Be.appendMessageTypeToURL&&(a.match(/\/$/)||(a+="/"),n&&(a+=n));var o={url:a,sync:!1,messages:e,onSuccess:function(e){try{He.call(be,e)}catch(e){be._info("Exception during handling of messages",e)}},onFailure:function(e,t,n){try{var r=be.getTransport();n.connectionType=r?r.getType():"unknown",Je.call(be,e,t,n)}catch(e){be._info("Exception during handling of failure",e)}}};be._debug("Send",o),he.send(o,t)}}function j(e){_e>0||!0===De?Ie.push(e):D([e],!1)}function R(){Oe=0}function O(){return Oe<Be.maxBackoff&&(Oe+=Be.backoffIncrement),Oe}function A(){++_e,be._debug("Starting batch, depth",_e)}function P(){var e=Ie;Ie=[],e.length>0&&D(e,!1)}function L(){if(--_e,be._debug("Ending batch, depth",_e),_e<0)throw"Calls to startBatch() and endBatch() are not paired";0!==_e||b()||De||P()}function M(){if(!b()){var e={id:T(),channel:"/meta/connect",connectionType:he.getType()};Ne||(e.advice={timeout:0}),y("connecting"),be._debug("Connect sent",e),D([e],!0,"connect"),y("connected")}}function E(e){y("connecting"),I(function(){M()},e)}function U(e){e&&(Le=be._mixin(!1,{},Be.advice,e),be._debug("New advice",Le))}function N(e){if(_(),e&&he&&he.abort(),we=!1,he=null,y("disconnected"),Se=null,_e=0,R(),Ue=!1,Ne=!1,qe=0,Ke=null,Ie.length>0){var t=Ie;Ie=[],Je.call(be,void 0,t,{reason:"Disconnected"})}}function q(e,t,n){var r=be.onTransportException;if(d(r)){be._debug("Invoking transport exception handler",e,t,n);try{r.call(be,n,e,t)}catch(e){be._info("Exception during execution of transport exception handler",e)}}}function F(e,t){d(e)&&(t=e,e=void 0),Se=null,v(),b()&&xe.reset(!0),U({}),_e=0,De=!0,me=e,ve=t;var n=be.getURL(),r=xe.findTransportTypes("1.0",we,n),s={id:T(),version:"1.0",minimumVersion:"1.0",channel:"/meta/handshake",supportedConnectionTypes:r,advice:{timeout:Le.timeout,interval:Le.interval}},i=be._mixin(!1,{},me,s);if(be._putCallback(i.id,t),!he&&!(he=xe.negotiateTransport(r,"1.0",we,n))){var a="Could not find initial transport among: "+xe.getTransportTypes();throw be._warn(a),a}be._debug("Initial transport is",he.getType()),y("handshaking"),be._debug("Handshake sent",i),D([i],!1,"handshake")}function K(e){y("handshaking"),De=!0,I(function(){F(me,ve)},e)}function B(e,t){try{e.call(be,t)}catch(e){var n=be.onCallbackException;if(d(n)){be._debug("Invoking callback exception handler",e);try{n.call(be,e,t)}catch(e){be._info("Exception during execution of callback exception handler",e)}}else be._info("Exception during execution of message callback",e)}}function H(e){var t=be._getCallback([e.id]);d(t)&&(delete Me[e.id],B(t,e))}function J(e){var t=Ee[e.id];if(delete Ee[e.id],t){be._debug("Handling remote call response for",e,"with context",t);var n=t.timeout;n&&be.clearTimeout(n);var r=t.callback;if(d(r))return B(r,e),!0}return!1}function W(e){be._debug("Transport failure handling",e),e.transport&&(he=e.transport),e.url&&he.setURL(e.url);var t=e.action,n=e.delay||0;switch(t){case"handshake":K(n);break;case"retry":E(n);break;case"none":N(!0);break;default:throw"Unknown action "+t}}function X(e,t){H(e),S("/meta/handshake",e),S("/meta/unsuccessful",e),b()&&(t.action="none"),be.onTransportFailure.call(be,e,t,W)}function z(e){var t=be.getURL();if(e.successful){var n=be._isCrossDomain(p(t)[2]),r=xe.negotiateTransport(e.supportedConnectionTypes,e.version,n,t);if(null===r)return e.successful=!1,void X(e,{cause:"negotiation",action:"none",transport:null});he!==r&&(be._debug("Transport",he.getType(),"->",r.getType()),he=r),Se=e.clientId,De=!1,P(),e.reestablish=Ue,Ue=!0,H(e),S("/meta/handshake",e),Fe=e["x-messages"]||0;var s=b()?"none":Le.reconnect||"retry";switch(s){case"retry":R(),0===Fe?E(0):be._debug("Processing",Fe,"handshake-delivered messages");break;case"none":N(!0);break;default:throw"Unrecognized advice action "+s}}else X(e,{cause:"unsuccessful",action:Le.reconnect||"handshake",transport:he})}function G(e){X(e,{cause:"failure",action:"handshake",transport:null})}function V(e){return"disconnected"===ke||!(!Ke||Ke.id!==e.id)&&(Ke=null,!0)}function $(e,t){S("/meta/connect",e),S("/meta/unsuccessful",e),b()&&(t.action="none"),be.onTransportFailure.call(be,e,t,W)}function Z(e){if(V(e))if(Ne=e.successful){S("/meta/connect",e);var t=b()?"none":Le.reconnect||"retry";switch(t){case"retry":R(),E(Oe);break;case"none":N(!1);break;default:throw"Unrecognized advice action "+t}}else $(e,{cause:"unsuccessful",action:Le.reconnect||"retry",transport:he});else be._debug("Mismatched /meta/connect reply",e)}function Y(e){V(e)?(Ne=!1,$(e,{cause:"failure",action:"retry",transport:null})):be._debug("Mismatched /meta/connect failure",e)}function Q(e){N(!0),H(e),S("/meta/disconnect",e),S("/meta/unsuccessful",e)}function ee(e){e.successful?(N(!1),H(e),S("/meta/disconnect",e)):Q(e)}function te(e){Q(e)}function ne(e){var t=Re[e.subscription];if(t)for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];r&&!r.listener&&(delete t[n],be._debug("Removed failed subscription",r))}H(e),S("/meta/subscribe",e),S("/meta/unsuccessful",e)}function re(e){e.successful?(H(e),S("/meta/subscribe",e)):ne(e)}function se(e){ne(e)}function ie(e){H(e),S("/meta/unsubscribe",e),S("/meta/unsuccessful",e)}function ae(e){e.successful?(H(e),S("/meta/unsubscribe",e)):ie(e)}function oe(e){ie(e)}function ce(e){J(e)||(H(e),S("/meta/publish",e),S("/meta/unsuccessful",e))}function ue(e){void 0!==e.data?J(e)||(S(e.channel,e),Fe>0&&0==--Fe&&(be._debug("Processed last handshake-delivered message"),E(0))):void 0===e.successful?be._warn("Unknown Bayeux Message",e):e.successful?(H(e),S("/meta/publish",e)):ce(e)}function de(e){ce(e)}function le(e){if(qe=0,void 0!==(e=x(e))&&null!==e)switch(U(e.advice),e.channel){case"/meta/handshake":z(e);break;case"/meta/connect":Z(e);break;case"/meta/disconnect":ee(e);break;case"/meta/subscribe":re(e);break;case"/meta/unsubscribe":ae(e);break;default:ue(e)}}function fe(e){var t=Re[e];if(t)for(var n in t)if(t.hasOwnProperty(n)&&t[n])return!0;return!1}function pe(e,t){var n={scope:e,method:t};if(d(e))n.scope=void 0,n.method=e;else if(u(t)){if(!e)throw"Invalid scope "+e;if(n.method=e[t],!d(n.method))throw"Invalid callback "+t+" for scope "+e}else if(!d(t))throw"Invalid callback "+t;return n}function ge(e,t,n,r){var s=pe(t,n);be._debug("Adding",r?"listener":"subscription","on",e,"with scope",s.scope,"and callback",s.method);var i=++je,a={id:i,channel:e,scope:s.scope,callback:s.method,listener:r},o=Re[e];return o||(o={},Re[e]=o),o[i]=a,be._debug("Added",r?"listener":"subscription",a),a}var he,me,ve,ye=new t,be=this,Te=s||"default",we=!1,xe=new r,ke="disconnected",Ce=0,Se=null,_e=0,Ie=[],De=!1,je=0,Re={},Oe=0,Ae=null,Pe=[],Le={},Me={},Ee={},Ue=!1,Ne=!1,qe=0,Fe=0,Ke=null,Be={useWorkerScheduler:!0,protocol:null,stickyReconnect:!0,connectTimeout:0,maxConnections:2,backoffIncrement:1e3,maxBackoff:6e4,logLevel:"info",maxNetworkDelay:1e4,requestHeaders:{},appendMessageTypeToURL:!0,autoBatch:!1,urls:{},maxURILength:2e3,advice:{timeout:6e4,interval:0,reconnect:void 0,maxInterval:0}};this._mixin=function(e,t,n){for(var r=t||{},s=2;s<arguments.length;++s){var a=arguments[s];if(void 0!==a&&null!==a)for(var o in a)if(a.hasOwnProperty(o)){var c=i(a,o),u=i(r,o);if(c===t)continue;if(void 0===c)continue;if(e&&"object"==typeof c&&null!==c)if(c instanceof Array)r[o]=this._mixin(e,u instanceof Array?u:[],c);else{var d="object"!=typeof u||u instanceof Array?{}:u;r[o]=this._mixin(e,d,c)}else r[o]=c}}return r},this._warn=function(){f("warn",arguments)},this._info=function(){"warn"!==Be.logLevel&&f("info",arguments)},this._debug=function(){"debug"===Be.logLevel&&f("debug",arguments)},this._isCrossDomain=function(e){return!!(window.location&&window.location.host&&e)&&e!==window.location.host};var He,Je;this.send=j,this._getCallback=function(e){return Me[e]},this._putCallback=function(e,t){var n=this._getCallback(e);return d(t)&&(Me[e]=t),n},this.onTransportFailure=function(e,t,n){this._debug("Transport failure",t,"for",e);var r=this.getTransportRegistry(),s=this.getURL(),i=this._isCrossDomain(p(s)[2]),a=r.findTransportTypes("1.0",i,s);if("none"===t.action){if("/meta/handshake"===e.channel&&!t.transport){var o="Could not negotiate transport, client=["+a+"], server=["+e.supportedConnectionTypes+"]";this._warn(o),q(he.getType(),null,{reason:o,connectionType:he.getType(),transport:he})}}else if(t.delay=this.getBackoffPeriod(),"/meta/handshake"===e.channel){if(!t.transport){var c=he?he.getType():null,u=r.negotiateTransport(a,"1.0",i,s);if(u){var d=u.getType();this._debug("Transport",c,"->",d),q(c,d,e.failure),t.action="handshake",t.transport=u}else this._warn("Could not negotiate transport, client=["+a+"]"),q(c,null,e.failure),t.action="none"}"none"!==t.action&&this.increaseBackoffPeriod()}else{var l=(new Date).getTime();if(0===qe&&(qe=l),"retry"===t.action){t.delay=this.increaseBackoffPeriod();var f=Le.maxInterval;if(f>0){var g=Le.timeout+Le.interval+f,h=l-qe;h+Oe>g&&(t.action="handshake")}}"handshake"===t.action&&(t.delay=0,r.reset(!1),this.resetBackoffPeriod())}n.call(be,t)},this.receive=le,He=function(e){be._debug("Received",e);for(var t=0;t<e.length;++t)le(e[t])},Je=function(e,t,n){be._debug("handleFailure",e,t,n),n.transport=e;for(var r=0;r<t.length;++r){var s=t[r],i={id:s.id,successful:!1,channel:s.channel,failure:n};switch(n.message=s,s.channel){case"/meta/handshake":G(i);break;case"/meta/connect":Y(i);break;case"/meta/disconnect":te(i);break;case"/meta/subscribe":i.subscription=s.subscription,se(i);break;case"/meta/unsubscribe":i.subscription=s.subscription,oe(i);break;default:de(i)}}},this.registerTransport=function(e,t,n){var r=xe.add(e,t,n);return r&&(this._debug("Registered transport",e),d(t.registered)&&t.registered(e,this)),r},this.unregisterTransport=function(e){var t=xe.remove(e);return null!==t&&(this._debug("Unregistered transport",e),d(t.unregistered)&&t.unregistered()),t},this.unregisterTransports=function(){xe.clear()},this.getTransportTypes=function(){return xe.getTransportTypes()},this.findTransport=function(e){return xe.find(e)},this.getTransportRegistry=function(){return xe},this.configure=function(e){g.call(this,e)},this.init=function(e,t){this.configure(e),this.handshake(t)},this.handshake=function(e,t){if("disconnected"!==ke)throw"Illegal state: handshaken";F(e,t)},this.disconnect=function(e,t){if(!b()){d(e)&&(t=e,e=void 0);var n={id:T(),channel:"/meta/disconnect"},r=this._mixin(!1,{},e,n);be._putCallback(r.id,t),y("disconnecting"),D([r],!1,"disconnect")}},this.startBatch=function(){A()},this.endBatch=function(){L()},this.batch=function(e,t){var n=pe(e,t);this.startBatch();try{n.method.call(n.scope),this.endBatch()}catch(e){throw this._info("Exception during execution of batch",e),this.endBatch(),e}},this.addListener=function(e,t,n){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";return ge(e,t,n,!0)},this.removeListener=function(e){if(!(e&&e.channel&&"id"in e))throw"Invalid argument: expected subscription, not "+e;h(e)},this.clearListeners=function(){Re={}},this.subscribe=function(e,t,n,r,s){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";if(b())throw"Illegal state: disconnected";d(t)&&(s=r,r=n,n=t,t=void 0),d(r)&&(s=r,r=void 0);var i=!fe(e),a=ge(e,t,n,!1);if(i){var o={id:T(),channel:"/meta/subscribe",subscription:e},c=this._mixin(!1,{},r,o);be._putCallback(c.id,s),j(c)}return a},this.unsubscribe=function(e,t,n){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(b())throw"Illegal state: disconnected";d(t)&&(n=t,t=void 0),this.removeListener(e);var r=e.channel;if(!fe(r)){var s={id:T(),channel:"/meta/unsubscribe",subscription:r},i=this._mixin(!1,{},t,s);be._putCallback(i.id,n),j(i)}},this.resubscribe=function(e,t){if(m(e),e)return this.subscribe(e.channel,e.scope,e.callback,t)},this.clearSubscriptions=function(){v()},this.publish=function(e,t,n,r){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!u(e))throw"Illegal argument type: channel must be a string";if(/^\/meta\//.test(e))throw"Illegal argument: cannot publish to meta channels";if(b())throw"Illegal state: disconnected";d(t)?(r=t,t={},n=void 0):d(n)&&(r=n,n=void 0);var s={id:T(),channel:e,data:t},i=this._mixin(!1,{},n,s);be._putCallback(i.id,r),j(i)},this.publishBinary=function(e,t,n,r,s){d(t)?(s=t,t=new ArrayBuffer(0),n=!0,r=void 0):d(n)?(s=n,n=!0,r=void 0):d(r)&&(s=r,r=void 0);var i={meta:r,data:t,last:n},a={ext:{binary:{}}};this.publish(e,i,a,s)},this.remoteCall=function(e,t,n,r,s){if(arguments.length<1)throw"Illegal arguments number: required 1, got "+arguments.length;if(!u(e))throw"Illegal argument type: target must be a string";if(b())throw"Illegal state: disconnected";if(d(t)?(s=t,t={},n=Be.maxNetworkDelay,r=void 0):d(n)?(s=n,n=Be.maxNetworkDelay,r=void 0):d(r)&&(s=r,r=void 0),"number"!=typeof n)throw"Illegal argument type: timeout must be a number";e.match(/^\//)||(e="/"+e);var i="/service"+e,a={id:T(),channel:i,data:t},o=this._mixin(!1,{},r,a),c={callback:s};n>0&&(c.timeout=be.setTimeout(function(){be._debug("Timing out remote call",o,"after",n,"ms"),ce({id:o.id,error:"406::timeout",successful:!1,failure:{message:o,reason:"Remote Call Timeout"}})},n),be._debug("Scheduled remote call timeout",o,"in",n,"ms")),Ee[o.id]=c,j(o)},this.remoteCallBinary=function(e,t,n,r,s,i){d(t)?(i=t,t=new ArrayBuffer(0),n=!0,r=void 0,s=Be.maxNetworkDelay):d(n)?(i=n,n=!0,r=void 0,s=Be.maxNetworkDelay):d(r)?(i=r,r=void 0,s=Be.maxNetworkDelay):d(s)&&(i=s,s=Be.maxNetworkDelay);var a={meta:r,data:t,last:n},o={ext:{binary:{}}};this.remoteCall(e,a,s,o,i)},this.getStatus=function(){return ke},this.isDisconnected=b,this.setBackoffIncrement=function(e){Be.backoffIncrement=e},this.getBackoffIncrement=function(){return Be.backoffIncrement},this.getBackoffPeriod=function(){return Oe},this.increaseBackoffPeriod=function(){return O()},this.resetBackoffPeriod=function(){R()},this.setLogLevel=function(e){Be.logLevel=e},this.registerExtension=function(e,t){if(arguments.length<2)throw"Illegal arguments number: required 2, got "+arguments.length;if(!u(e))throw"Illegal argument type: extension name must be a string";for(var n=!1,r=0;r<Pe.length;++r)if(Pe[r].name===e){n=!0;break}return n?(this._info("Could not register extension with name",e,"since another extension with the same name already exists"),!1):(Pe.push({name:e,extension:t}),this._debug("Registered extension",e),d(t.registered)&&t.registered(e,this),!0)},this.unregisterExtension=function(e){if(!u(e))throw"Illegal argument type: extension name must be a string";for(var t=!1,n=0;n<Pe.length;++n){var r=Pe[n];if(r.name===e){Pe.splice(n,1),t=!0,this._debug("Unregistered extension",e);var s=r.extension;d(s.unregistered)&&s.unregistered();break}}return t},this.getExtension=function(e){for(var t=0;t<Pe.length;++t){var n=Pe[t];if(n.name===e)return n.extension}return null},this.getName=function(){return Te},this.getClientId=function(){return Se},this.getURL=function(){if(he){var e=he.getURL();if(e)return e;if(e=Be.urls[he.getType()])return e}return Be.url},this.getTransport=function(){return he},this.getConfiguration=function(){return this._mixin(!0,{},Be)},this.getAdvice=function(){return this._mixin(!0,{},Le)},this.setTimeout=function(e,t){return ye.setTimeout(function(){try{be._debug("Invoking timed function",e),e()}catch(t){be._debug("Exception invoking timed function",e,t)}},t)},this.clearTimeout=function(e){ye.clearTimeout(e)},window.WebSocket&&this.registerTransport("websocket",new c),this.registerTransport("long-polling",new a),this.registerTransport("callback-polling",new o)},d=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z",".","-",":","+","=","^","!","/","*","?","&","<",">","(",")","[","]","{","}","@","%","$","#"],l=[0,68,0,84,83,82,72,0,75,76,70,65,0,63,62,69,0,1,2,3,4,5,6,7,8,9,64,0,73,66,74,71,81,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,77,0,78,67,0,0,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,79,0,80,0,0];return{CometD:u,Transport:s,RequestTransport:i,LongPollingTransport:a,CallbackPollingTransport:o,WebSocketTransport:c,Utils:n,Z85:{encode:function(e){var t=null;if(e instanceof ArrayBuffer?t=e:e.buffer instanceof ArrayBuffer?t=e.buffer:Array.isArray(e)&&(t=new Uint8Array(e).buffer),null==t)throw"Cannot Z85 encode "+e;for(var n=t.byteLength,r=n%4,s=4-(0===r?4:r),i=new DataView(t),a="",o=0,c=0;c<n+s;++c){var u=c>=n;if(o=256*o+(u?0:i.getUint8(c)),(c+1)%4==0){for(var l=52200625,f=5;f>0;--f){if(!u||f>s){var p=Math.floor(o/l)%85;a+=d[p]}l/=85}o=0}}return a},decode:function(e){for(var t=e.length%5,n=5-(0===t?5:t),r=0;r<n;++r)e+=d[d.length-1];for(var s=e.length,i=new ArrayBuffer(4*s/5-n),a=new DataView(i),o=0,c=0,u=0,f=0;f<s;++f){var p=e.charCodeAt(c++)-32;if(o=85*o+l[p],c%5==0){for(var g=16777216;g>=1;)u<a.byteLength&&a.setUint8(u++,Math.floor(o/g)%256),g/=256;o=0}}return i}}}}()}()},"./webapp/lib/thirdparty/jquery.cometd.js":function(e,t,n){"use strict";var r,s,i,a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(o,c){"object"===a(t)?e.exports=c(n("./node_modules/jquery/dist/jquery.js"),n("./node_modules/cometd/cometd.js")):(s=[n("./node_modules/jquery/dist/jquery.js"),n("./node_modules/cometd/cometd.js")],r=c,void 0!==(i="function"==typeof r?r.apply(t,s):r)&&(e.exports=i))}(0,function(e,t){function n(e,t){if(t)for(var n in t)if(t.hasOwnProperty(n)){if("content-type"===n.toLowerCase())continue;e.setRequestHeader(n,t[n])}}function r(){var r=new t.LongPollingTransport,s=t.Transport.derive(r);return s.xhrSend=function(t){return e.ajax({url:t.url,async:!0!==t.sync,type:"POST",contentType:"application/json;charset=UTF-8",data:t.body,global:!1,xhrFields:{withCredentials:!0},beforeSend:function(e){return e.withCredentials=!0,n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},s}function s(){var r=new t.CallbackPollingTransport,s=t.Transport.derive(r);return s.jsonpSend=function(t){e.ajax({url:t.url,async:!0!==t.sync,type:"GET",dataType:"jsonp",jsonp:"jsonp",data:{message:t.body},beforeSend:function(e){return n(e,t.headers),!0},success:t.onSuccess,error:function(e,n,r){t.onError(n,r)}})},s}return e.CometD=function(e){var n=new t.CometD(e);return n.unregisterTransports(),window.WebSocket&&n.registerTransport("websocket",new t.WebSocketTransport),n.registerTransport("long-polling",new r),n.registerTransport("callback-polling",new s),n},e.cometd=new e.CometD,e.cometd})},"./webapp/plugins/cx-webchat-service/controllers/legacy-controller.js":function(t,n,r){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=r("./node_modules/jquery/dist/jquery.js"),u=s(c),d=r("./webapp/plugins/cx-common/cx-common.js"),l=s(d),f=r("./node_modules/js-cookie/src/js.cookie.js"),p=s(f);s((s(r("./node_modules/cometd/cometd.js")),r("./webapp/lib/thirdparty/jquery.cometd.js"))),CXBus.registerModule("webchatservicelegacy",function(){function t(){n.registerEvents(["ready","restored","restoreTimeout","restoreFailed","messageReceived","error","started","ended","agentTypingStarted","agentTypingStopped","pollingStarted","pollingStopped","clientConnected","clientDisconnected","agentConnected","agentDisconnected","supervisorConnected","supervisorDisconnected","botConnected","botDisconnected","clientTypingStarted","clientTypingStopped","ajaxResponse","disconnected","reconnected","chatServerWentOffline","chatServerBackOnline","sleeping","waking"]);var t=setInterval,r=!1,s=3e3,c=3e3,d=3e3,f=500,g=1.2,h=3e4,m=0,v=0,y=5,b=!1,T=!0,w=!0,x=3e3,k=0,C={withCredentials:!1},S=!1,_={sessionID:"",userId:"",secureKey:"",alias:""},I="",D="_genesys.widgets.webchat.state",j=D+".session",R=D+".keys",O=D+".ping",A=D+".filters",P=D+".chatStartLock",L=1,M="",E=1,U=!1,N=!1,q=!1,F=!1,K=!1,B=6e4,H="",J="",W=l.default.getBrowserandOS(),X=[],z=[],G=[],V=[],$={},Z={},Y=!1,Q=!1,ee=!1,te=!1,ne={enabled:!1,cometURL:"",channel:"/service/chatV2/customer-support",apiURL:"",websocketEnabled:!0,logLevel:"info"},re=!1,se=0,ie=!1,ae=!1,oe=!1,ce=!1,ue={Timer:0,Timeout:2e3,TimeInterval:100,Interval:!1,IdleCount:0,IdleLimit:2,Text:""},de={standard:[/\{start\:[0-9]{9}\}/],custom:[]},le=[],fe=!1,pe=!1,ge=!1,he={enabled:!1,maxMessagePageSize:20},me=!1,ve=!1,ye=!1,be=!1,Te=!1,we=[],xe=["Authorization"];n.data("sleeping",!1),n.data("sessionActive",U);var ke=function(e,t,r){var s=u.default.Deferred();if(!U||me||l.default.getCookie(j)){if(!K){var i={alias:_.alias,secureKey:_.secureKey,userId:_.userId},r=r||{};if(r=u.default.extend(i,r),ee)ee&&(""==e?(e="requestChat",fe=s):N&&(fe=s),re?Ce(e,t,r,s):(ze(),l.default.watch(function(){return re},250).done(function(){Ce(e,t,r)})));else{var a=S?l.default.filterObjectProperties(n.data("App.requestHeader"),xe):{};"disconnect"==e&&(pe=s),l.default.request({url:H+_.sessionID+(e?"/"+e:""),type:t,crossDomain:!0,data:r,timeout:x,cache:!1,headers:u.default.extend({},{"Content-Type":"application/x-www-form-urlencoded"},a),xhrFields:C,success:function(e){if(K)return!1;e.id&&(e.sessionId=e.id),Ke(e),s.resolve(e||{}),F&&(F=!1,n.publish("reconnected")),!Q&&1==e.chatEnded&&2===e.statusCode&&e.errors&&e.errors.length>0&&n.publish("error",e),n.publishDirect("ajaxResponse",e)},error:function(t){if(K)return!1;0===t.status&&(F=!0,U?n.publish("disconnected"):n.publish("error",t));var r=t.responseJSON||{};if("refresh"==e&&r.errors&&r.errors.length>0)for(var i=0;i<r.errors.length;i++)204==r.errors[i].code&&r.errors.splice(i,1);r.errors&&r.errors.length>0&&n.publish("error",t),s.reject(t||{})},beforeSend:function(e){I&&e.setRequestHeader("apikey",I)}})}}}else _e();return s.promise()},Ce=function(e,t,n,r){if(ee&&te&&re){"send"==e&&(e="sendMessage");var s={operation:e,chatId:_.sessionID},i=u.default.extend(s,n);te.publish(ne.channel,i),r&&r.resolve({statusCode:0})}else r&&r.reject("CometD is not configured or there is a connection issue")},Se=function(t,r){var s=u.default.Deferred(),i=r.file;if(Be()){var a=new FormData,o=H+_.sessionID+(t||"");i&&a.append("file",i),ee?(o=ne.apiURL,a.append("operation",t)):(a.append("alias",_.alias),a.append("userId",_.userId)),a.append("secureKey",_.secureKey),l.default.request({type:"POST",url:o,xhrFields:C,mimeType:"multipart/form-data",contentType:!1,crossDomain:!0,headers:S?l.default.filterObjectProperties(n.data("App.requestHeader"),xe):{},timeout:k,processData:!1,data:a,beforeSend:function(e){I&&e.setRequestHeader("apikey",I)},success:function(e){e.id&&(e.sessionId=e.id),Ke(e),s.resolve(e||{}),F&&(F=!1,n.publish("disconnected")),n.publishDirect("ajaxResponse",e)},error:function(e){if(u.default.isEmptyObject(i))n.publish("error",e);else if(400===e.status){var t=JSON.parse(e.responseText);u.default.each(t.errors,function(){this.filename=i.name}),e.responseText=JSON.stringify(t),n.publish("error",e),s.reject(e||{})}else 0===e.status&&(e.errorReason="FileUploadError",e.filename=i.name,e.file=i,n.publish("error",e));s.reject(e||{})}})}else e.deferred.reject("No HTMl5 formData support on your browser");return s.promise()},_e=function(e){K=!0,n.command("stopPoll"),G=u.default.extend([],X),V=u.default.extend([],z),Ae(e),Fe(),U=!1,n.data("sessionActive",U),tt(),n.publish("ended"),n.command("App.deregisterAutoLoad")},Ie=function(e){var t=[],r=e.messages?u.default.extend(!0,[],e.messages):[];u.default.each(r,function(){if(Pe(this.index))if("Message"!=this.type||Ee(this.text)){for(var e=this,n=0;n<le.length;n++)e=le[n](e)||e;e=De(this),je(e),t.push(e),X.push(e),z.push(this)}else{var r=this;je(r)}}),t.length>0&&(ye&&t.sort(function(e,t){return t.index-e.index}),e.messages=e.messages.filter(function(e){return Ee(e.text||"")}),n.publish("messageReceived",{originalMessages:e.messages,messages:t,restoring:N,sessionData:_,oldMessages:ye,idleTimeCountDown:e.idleTimerExpire})),me&&M<=1&&(be=!0),!0===e.chatEnded&&!0===U&&_e(!0)},De=function(e){var t={},n=l.default.checkPath(e,"eventAttributes.structured-content.genesys-chat.content"),r=l.default.checkPath(e,"eventAttributes.GCTI_SYSTEM.party-info.style");if("string"==typeof n)try{n=JSON.parse(n)}catch(e){}if("string"==typeof r)try{r=JSON.parse(r)}catch(e){}return"TypingStarted"==e.type?t.isTyping=!0:"TypingStopped"==e.type&&(t.isTyping=!1),"FileUploaded"==e.type&&(t.fileDetails=e.userData),t.text=n&&n.text||e.text,t.type=e.type,t.index=e.index,t.timestamp=e.utcTime,t.html=e.html,t.bubble=e.bubble,t.userData=e.userData,t.from={id:e.from?parseInt(e.from.participantId):"",type:e.from?e.from.type:"",name:e.from?e.from.nickname:""},r&&"BOT"===r&&(t.from.type="Bot"),N&&(t.restoring=!0),e.index>=0&&e.index>=L&&(L=e.index+1,l.default.setCookie("_genesys.widgets.webchat.state.index",L)),t},je=function(e){var t=e.type,r=e.from.type,s=e.from.id,i={};if("Message"!=t&&"PushUrl"!=t&&"Notice"!=t||"Agent"!=r&&"Supervisor"!=r||(n.data("agentTyping",!1),n.publish("agentTypingStopped")),"ParticipantJoined"==t)switch("Agent"!=r&&"Supervisor"!=r||($[s]={name:e.from.name,connected:!0,supervisor:"Supervisor"==r,connectedTime:e.timestamp,disconnectedTime:!1}),i={message:e,agents:$,numAgentsConnected:Me()},r){case"Client":n.publish("clientConnected",i);break;case"Agent":n.publish("agentConnected",i);break;case"Bot":n.publish("botConnected",i);break;case"Supervisor":n.publish("supervisorConnected",i)}else if("ParticipantLeft"==t)switch($[s]&&($[s].connected=!1,$[s].disconnectedTime=e.timestamp),i={message:e,agents:$,numAgentsConnected:Me()},r){case"Client":n.publish("clientDisconnected",i);break;case"Agent":n.publish("agentDisconnected",i),n.data("agentTyping",!1),n.publish("agentTypingStopped");break;case"Bot":n.publish("botDisconnected",i);break;case"Supervisor":n.publish("supervisorDisconnected",i),n.data("agentTyping",!1),n.publish("agentTypingStopped")}"Agent"!=r&&"Supervisor"!=r||("TypingStarted"==t&&(n.data("agentTyping",!0),n.publish("agentTypingStarted",e)),"TypingStopped"==t&&(n.data("agentTyping",!1),n.publish("agentTypingStopped",e)))},Re=function(){return!me&&!!(T&&l.default.getCookie(O)&&rt()-parseInt(l.default.getCookie(O))>=B)&&(Oe(),Fe(),n.publish("restoreTimeout"),n.command("App.deregisterAutoLoad"),!0)},Oe=function(){me||(l.default.deleteCookie(j),l.default.deleteCookie(R),l.default.deleteCookie(O),l.default.deleteCookie("_genesys.widgets.webchat.state.index"))},Ae=function(e){e&&Oe(),U=!1,n.data("sessionActive",U),N=!1,b=!1,T=!0,K=!1,_.sessionID="",_.userId="",_.secureKey="",_.alias="",L=1,E=1,X=[],z=[],$={},Z={},v=0,se=0,q=!1,F=!1,we=[]},Pe=function(e){return!Z[e]&&(Z[e]=!0,!0)},Le=function(e,t){"string"==typeof e&&t instanceof RegExp&&(Ue(t),n.command("sendMessage",{message:e}))},Me=function(){var e=0;for(var t in $)!0===$[t].connected&&e++;return e},Ee=function(e){var t=l.default.getCookie(A);t&&JSON.parse(t).custom.length!==de.custom.length&&(de.custom=[],qe());for(var n=0;n<de.standard.length;n++)if((e+"").match(de.standard[n]))return!1;for(var r=0;r<de.custom.length;r++)if((e+"").match(de.custom[r]))return!1;return!0},Ue=function(e){if(e instanceof RegExp){e.length||(e=[e]);for(var t=0;t<e.length;t++)de.custom.filter(function(n){return String(n)===String(e[t])}).length||de.custom.push(e[t]);Ne()}},Ne=function(){for(var e,t={custom:[]},n=0;n<de.custom.length;n++)e=de.custom[n],t.custom.push({source:e.source,flags:e.flags});l.default.setCookie(A,JSON.stringify(t))},qe=function(){if(l.default.getCookie(A)){var e=JSON.parse(l.default.getCookie(A));return u.default.each(e.custom,function(){de.custom.push(new RegExp(this.source,this.flags))}),!0}return!1},Fe=function(){de.custom=[],l.default.deleteCookie(A)},Ke=function(e){if(!K){var t=_&&_.secureKey;e.chatId&&(_.sessionID=e.chatId),e.secureKey&&(_.secureKey=e.secureKey),e.alias&&(_.alias=e.alias),e.userId&&(_.userId=e.userId),me&&he.getSessionData?t!==_.secureKey&&he.getSessionData(_,p.default,l.default.getCookieOptions()):(l.default.setCookie(R,JSON.stringify({secureKey:_.secureKey,alias:_.alias,userId:_.userId})),l.default.setCookie(j,_.sessionID)),n.data("WebChatService.sessionData",_)}},Be=function(){return!!window.FormData},He=function(e){ee&&(e=e.data,2===e.statusCode&&e.errors&&e.errors.length>0&&n.publish("error",e)),e.chatEnded||e.errors||Ke(e),fe&&(fe.resolve(e),fe=!1,0!=e.statusCode&&tt()),0==e.statusCode?(q&&(n.publish("chatServerBackOnline"),n.publish("reconnected")),ie=!1,q=!1,v=0):1==e.statusCode&&(++v>y&&(n.publish("chatServerWentOffline"),v=0),q=!0),me&&(ae||ve?Ie(e):ae=!0),me||Ie(e),T=!1,N=!1,ye=!1},Je=function(e){return Ke(e),!0===e.chatEnded||void 0===e.chatEnded?(Oe(),K=!0,N=!1,_.sessionID="",_.secureKey="",_.alias="",_.userId="",n.publish("restoreTimeout"),n.command("App.deregisterAutoLoad"),tt(),!1):!1===e.chatEnded?(n.publish("restored"),n.command("App.registerAutoLoad"),Ie(e),N=!1,U=!0,n.data("sessionActive",U),n.command("startPoll"),me||l.default.setCookie(j,_.sessionID),1==e.statusCode&&(n.publish("restoredOffline"),q=!0),!0):void 0},We=function(e){ee&&e&&(e=e.data);var t={numAgentsConnected:0};U=!1,n.data("sessionActive",U),tt(),Oe(),Fe(),n.publish("supervisorDisconnected",t),n.publish("agentDisconnected",t),n.publish("clientDisconnected",t),n.publish("ended"),n.command("App.deregisterAutoLoad"),te=!1,pe&&(pe.resolve(e),pe=!1)},Xe=function(){S&&te&&"function"==typeof te.configure&&te.configure({requestHeaders:l.default.filterObjectProperties(n.data("App.requestHeader"),xe)})},ze=function(){ee&&(te=new u.default.CometD,te.websocketEnabled=ne.websocketEnabled,te.configure({url:ne.cometURL,logLevel:ne.logLevel,requestHeaders:S?l.default.filterObjectProperties(n.data("App.requestHeader"),xe):{}}),te.addListener("/meta/handshake",Ve),te.addListener("/meta/connect",Ge),te.addListener("/meta/disconnect",$e),te.addListener("/meta/publish",Ze),te.addListener(ne.channel,He),te.handshake())},Ge=function(e){if(Xe(),!te||te.isDisconnected())return void(re=!1);if(re=!0===e.successful,F&&re){if(F=!1,!q){n.publish("reconnected");var t=me?_:l.default.getCookie(R);"string"==typeof t&&t.length>0&&(t=JSON.parse(t)),ke("requestNotifications","POST",{userId:t.userId,secureKey:t.secureKey,alias:t.alias,transcriptPosition:L,message:""})}}else!F&&re?me||l.default.setCookie(O,rt()):F||re||"402::Unknown client"!=e.error&&(F=!0,n.publish("disconnected"))},Ve=function(e){if(!1===e.successful)fe&&5==++se&&(tt(),fe.reject({statusCode:1}),fe=!1,se=0);else if(!0===e.successful){re=!0,se=0;var t=me?_:l.default.getCookie(R);"string"==typeof t&&t.length>0&&(t=JSON.parse(t));var n=t||{},r=n.secureKey,s=n.userId,i=n.alias;r&&s&&!N&&ke("requestNotifications","POST",{userId:s,secureKey:r,alias:i,transcriptPosition:L,message:""})}},$e=function(e){te&&(Xe(),te.handshake(),n.publish("disconnected"),F=!0,q=!0,et())},Ze=function(e){!1===e.successful&&(fe?0!=e.statusCode&&(fe.reject({statusCode:1}),fe=!1,tt()):n.publish("error",e))},Ye=function(){n.command("wake")},Qe=function(){w&&(s=f)},et=function(){if(!ie&&U){var e=me?_:l.default.getCookie(R);"string"==typeof e&&e.length>0&&(e=JSON.parse(e)),ie=!0,l.default.watch(function(t,n){return ie&&ke("requestNotifications","POST",{userId:e.userId,secureKey:e.secureKey,alias:e.alias,transcriptPosition:L,message:""}),!ie},3e3,30).fail(function(){y=0,n.publish("chatServerTimeout")})}},tt=function(){ee&&te&&(Xe(),te.disconnect(),te=!1,re=!1)},nt=function(){N=!1,_.sessionID="",_.secureKey="",_.alias="",_.userId="",n.publish("restoreFailed"),ct()},rt=function(){return(new Date).getTime()},st=function(){var e=parseInt(l.default.getCookie(P))||0;return!(rt()-e>2e3&&(ot(),1))},it=function(){l.default.setCookie(P,rt())},at=function(){it(),Te=setInterval(it,500)},ot=function(){Te&&clearInterval(Te),l.default.deleteCookie(P),Te=!1},ct=function(){we.length&&(we.forEach(function(e){e.resolve({sessionActive:U})}),we=[])};n.registerCommand("fetchHistory",function(e){me?(ye=!0,M-=he.maxMessagePageSize,be?(ye=!1,e.deferred.reject("No more messages to fetch")):ke("refresh","POST",{userId:_.userId,secureKey:_.secureKey,alias:_.alias,transcriptPosition:M<=0?1:M,message:""}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})):e.deferred.reject("Fetching messages history applies to only Asynchronous chat.")}),n.registerCommand("configure",function(e){if(e.data&&Object.keys(e.data).length){var t=e.data,r="string",i="number",a="boolean",m="object",v="function",b={},T={};if(o(t.apikey)!=r&&o(t.apikey)!=i||(I=t.apikey),o(t.endpoint)==r&&(J=t.endpoint),o(t.userData)==m&&u.default.extend(T,t.userData),o(t.serverURL)==r&&(H=t.serverURL),o(t.ajaxTimeout)==i&&(x=parseInt(t.ajaxTimeout)),o(t.fileUploadTimeout)==i&&(k=parseInt(t.fileUploadTimeout)),o(t.xhrFields)==m&&u.default.extend(C,t.xhrFields),"object"==o(t.cometD)&&(!0===t.cometD.enabled&&(ee=!0),u.default.extend(ne,t.cometD)),o(t.dataURL)!=r||ee||(H=t.dataURL.replace(/\/!*$/,""),ee||(H+="/")),o(t.pollExceptionLimit)==i&&(y=parseInt(t.pollExceptionLimit)),o(t.pollIntervalIdle_ms)==i&&(d=parseInt(t.pollIntervalIdle_ms)),o(t.sleepEnabled)==a&&(oe=t.sleepEnabled),o(t.dynamicPolling)==a&&(w=t.dynamicPolling),o(t.pollRate)==i&&t.pollRate>=1e3&&t.pollRate<=3e4&&(c=parseInt(t.pollRate),s=c),o(t.pollRateMin)==i&&t.pollRateMin>=250&&t.pollRateMax<=(t.pollRateMax||c)&&(f=parseInt(t.pollRateMin)),o(t.pollRateMax)==i&&t.pollRateMax<=3e4&&t.pollRateMax>=f&&(d=parseInt(t.pollRateMax)),o(t.pollRateMult)==i&&t.pollRateMult>1&&(g=t.pollRateMult),o(t.pollRateSleep)==i&&t.pollRateSleep<=3e4&&t.pollRateSleep>=1e3&&(h=parseInt(t.pollRateSleep)),o(t.restoreTimeout)==i&&(B=parseInt(t.restoreTimeout)),o(t.maxMessageLength)==i&&(Y=t.maxMessageLength),o(t.enableCustomHeader)==a&&(S=t.enableCustomHeader),o(t.async)==m&&ee){if(o(t.async.enabled)==a&&(he.enabled=t.async.enabled),o(t.async.maxMessagePageSize)==i&&(he.maxMessagePageSize=t.async.maxMessagePageSize),o(t.async.setSessionData)==v){he.setSessionData=t.async.setSessionData;var _=he.setSessionData("_genesys.widgets.webchat.state.open",p.default,l.default.getCookieOptions());"undefined"!==_&&_&&"string"==typeof _&&_.length>0?b=JSON.parse(_):_&&"object"==(void 0===_?"undefined":o(_))&&Object.keys(_).length&&(b=_)}o(t.async.getSessionData)==v&&(he.getSessionData=t.async.getSessionData),me=he.enabled&&ee}l.default.getCookie(j)?(me=!1,n.command("restore").done(function(){ct()})):Object.keys(b).length&&(ee?(me=!0,n.command("restore",{sessionData:b}).done(function(){ct()})):e.deferred.reject("Invalid configuration. WebChatService supports Async chat only in CometD mode.")),n.data("userData",T),e.deferred.resolve()}else e.deferred.reject("Invalid configuration")}),n.registerCommand("startChat",function(e){if(Ye(),U)return e.deferred.reject("There is already an active chat session"),!1;if(!ee&&st())return e.deferred.reject({statusCode:1}),!1;e.data&&"boolean"==typeof e.data.async&&(me=e.data.async);var t={};if("string"==typeof e.data.userData&&""!=e.data.userData.trim()){try{t=JSON.parse(e.data.userData.trim())}catch(t){return e.deferred.reject("malformed JSON provided in userData property"),!1}"object"==(void 0===t?"undefined":o(t))&&(t=u.default.extend({},n.data("userData"),t))}else"object"==o(e.data.userData)&&(t=u.default.extend({},n.data("userData"),e.data.userData));n.data("userData",a({},n.data("userData"),t));var r={_genesys_source:l.default.isMobileDevice()?"mobile":"web",_genesys_referrer:document.referrer,_genesys_url:document.location.href,_genesys_pageTitle:document.title,_genesys_browser:W.browser,_genesys_OS:W.os,_genesys_widgets:l.default.data("version")};t=u.default.extend({GCTI_LanguageCode:ge},n.data("userData"),r),me&&(ve=!0,t=u.default.extend({GCTI_Chat_AsyncMode:"true"},t)),Ae(!0),G=[],V=[];var s={nickname:e.data.nickname||"",firstName:e.data.firstname||"",lastName:e.data.lastname||"",emailAddress:e.data.email||"",subject:e.data.subject||"",text:"",userData:t};J&&(s.endpoint=J),ee||at(),ke("","POST",s).done(function(t){0==t.statusCode?(U=!0,n.data("sessionActive",U),Ke(t),n.publish("started",_),n.command("startPoll"),n.command("App.registerAutoLoad"),e.deferred.resolve(t)):e.deferred.reject(t)}).fail(function(t){e.deferred.reject(t)}).always(function(){ee||ot()})}),n.registerCommand("getFileLimits",function(e){Se(ee?"fileGetLimits":"/file/limits",{}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}),n.registerCommand("endChat",function(e){if(!U)return e.deferred.reject("There is no active chat session"),!1;G=u.default.extend([],X),V=u.default.extend([],z),n.command("stopPoll"),ke("disconnect","POST",{alias:_.alias,secureKey:_.secureKey,userId:_.userId}).done(function(){Q=!0}).fail(function(t){e.deferred.reject(t)}).always(We).always(function(){Ae(!0)})}),n.registerCommand("getSessionData",function(e){e.deferred.resolve(_)}),n.registerCommand("restore",function(e){if(N)return e.deferred.reject("Already restoring. Ignoring request."),!1;U&&(ct(),e.deferred.reject("Chat session is already active, ignoring restore command."));var t,r;e.data&&e.data.async&&!0===e.data.async.enabled&&(me=!0),me?e.data&&e.data.sessionData&&(_=e.data.sessionData)&&(t=_.sessionID,r=_):(t=l.default.getCookie(j),r=l.default.getCookie(R)),"string"==typeof r&&r.length>0&&(r=JSON.parse(r)),t&&r&&Object.keys(r).length&&!Re()?(N=!0,_.sessionID=t,me?ke("refresh","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:Number(-1)}).done(function(t){if(!1===t.chatEnded&&t.messages.length>0){L=parseInt(t.messages[0].index);var s={_genesys_source:l.default.isMobileDevice()?"mobile":"web",_genesys_referrer:document.referrer,_genesys_url:document.location.href,_genesys_pageTitle:document.title,_genesys_browser:W.browser,_genesys_OS:W.os,_genesys_widgets:l.default.data("version")},i=u.default.extend({GCTI_LanguageCode:ge,GCTI_Chat_AsyncMode:"true"},n.data("userData"),s);"number"==typeof L&&(M=parseInt(L-he.maxMessagePageSize),M=M<=0?1:M,ke("requestNotifications","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:M,userData:i,message:""}).done(function(t){t&&0==t.statusCode?(N=!1,U=!0,n.data("sessionActive",U),n.publish("restored",{async:!0}),n.data("WebChatService.mode",{async:!0}),n.command("App.registerAutoLoad"),ct(),e.deferred.resolve(t)):(ct(),e.deferred.reject(t))}).fail(function(t){nt(),e.deferred.reject()}))}else ct(),e.deferred.reject(t)}).fail(function(t){nt(),e.deferred.reject()}):ke(ee?"requestNotifications":"refresh","POST",{userId:r.userId,secureKey:r.secureKey,alias:r.alias,transcriptPosition:L,message:""}).done(function(t){!0===Je(t)?(ct(),e.deferred.resolve(t)):(ct(),e.deferred.reject(t))}).fail(function(t){nt(),e.deferred.reject()})):(ct(),e.deferred.reject("No chat session found to restore."))}),n.registerCommand("sendMessage",function(e){if(Ye(),F)return e.deferred.resolve({statusCode:1}),!1;if(!U)return e.deferred.reject("There is no active chat session"),!1;if("string"!=typeof e.data.message||""==(e.data.message+"").trim())return e.deferred.reject("No message text provided"),!1;if(Y&&[].concat(i(e.data.message)).length>Y)return e.deferred.reject("Message length exceeds configured threshold of ("+Y+") characters"),!1;ue.Interval&&n.publish("clientTypingStopped"),clearInterval(ue.Interval),ue.Interval=!1,ue.Timer=0,ue.text="",ue.IdleCount=0;var t={message:e.data.message,messageType:e.data.type||"text",userId:_.userId,secureKey:_.secureKey,alias:_.alias};if("number"==typeof e.data.parentMessageID||"string"==typeof e.data.parentMessageID&&e.data.parentMessageID.length>0){var r='{"general-properties": {"related-event-id":"'+e.data.parentMessageID+'"}}';t.eventAttributes=ee?JSON.parse(r):r,delete e.data.parentMessageID}ke("send","POST",t).done(function(t){!0===t.chatEnded&&!0===U&&_e(!0),e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)}).always(function(){Qe()})}),n.registerCommand("sendFile",function(e){if(Ye(),!U)return e.deferred.reject("There is no active chat session"),!1;var t=!1,n=e.data.files,r=n.files[0],s=r.name,i={},a=ee?"fileUpload":"/file";i.file=r,t=Se(a,i),t.done(function(t){if("string"==typeof t&&(t=JSON.parse(t)),0==t.statusCode){var n=new FileReader;(0,u.default)(n).on("load",function(n){var r=n.target.result,i=[],a={from:{type:"Client"},source:r,type:"FileUploaded",timestamp:rt(),filename:s};i.push(a),e.deferred.resolve(t)}),n.readAsDataURL(r)}else e.deferred.reject(t)}).fail(function(t){e.deferred.reject(t)}).always(function(){Qe()})}),n.registerCommand("downloadFile",function(e){var t;if(ee&&ne.apiURL)t=(0,u.default)("<form method='POST' enctype='multipart/form-data' target='_blank' action="+ne.apiURL+"><input name='secureKey' value="+_.secureKey+" type='hidden'><input name='fileId' value="+e.data.fileId+" type='hidden'><input name='operation' value='fileDownload' type='hidden'></form>").appendTo(document.body);else if(ee)e.deferred.reject("Could not download file. Please ensure WebChat is configured properly.");else{var n=H+_.sessionID+"/file/"+e.data.fileId+"/download";t=(0,u.default)("<form method='POST' enctype='multipart/form-data' target='_blank' action="+n+"><input name='alias' value="+_.alias+" type='hidden'><input name='secureKey' value="+_.secureKey+" type='hidden'><input name='userId' value="+_.userId+" type='hidden'></form>").appendTo(document.body)}t&&(t.submit(),e.deferred.resolve())}),n.registerCommand("sendFilteredMessage",function(e){Ye(),U?(Le(e.data.message,e.data.regex),e.deferred.resolve()):e.deferred.reject("No active chat session.")}),n.registerCommand("addPrefilter",function(e){if(e.data.filters&&e.data.filters instanceof RegExp)Ue(e.data.filters),e.deferred.resolve(u.default.extend({},de.custom));else if(e.data.filters.length>0&&e.data.filters[0]instanceof RegExp){for(var t=0;t<e.data.filters.length;t++)Ue(e.data.filters[t]);e.deferred.resolve(u.default.extend({},de.custom))}else e.deferred.reject("Missing or invalid filters provided. Please provide a regular expression or an array of regular expressions")}),n.registerCommand("startPoll",function(e){return ee?(e.deferred.reject("Polling is not supported when using CometD"),!1):U?(!1===r&&(r=t(function(){var e=n.data("sleeping");!e&&!b&&l.default.time()-m>=s?(n.command("poll"),m=l.default.time(),w&&(s<d&&(s=parseInt(s*g)),s>d&&(s=d))):e&&!b&&l.default.time()-m>=h&&(n.command("poll"),m=l.default.time())},parseInt(f/2)),Qe(),n.publish("pollingStarted")),void e.deferred.resolve()):(e.deferred.reject("There is no active chat session"),!1)}),n.registerCommand("stopPoll",function(e){if(0==r)return e.deferred.reject("Not currently polling. Ignoring command."),!1;0!=r&&(clearInterval(r),r=!1,n.publish("pollingStopped")),e.deferred.resolve()}),n.registerCommand("poll",function(e){e.commander!=n.namespace()&&e.deferred.reject("Access Denied to private command. Only WebChatService is allowed to invoke this command"),b?e.deferred.reject("previous poll has not finished"):(b=!0,me||l.default.setCookie(O,rt()),ke("refresh","POST",{userId:_.userId,secureKey:_.secureKey,alias:_.alias,transcriptPosition:L,message:ce?ce.val():""}).done(function(t){He(t),e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)}).always(function(){b=!1}))}),n.registerCommand("sleep",function(e){!oe||me||ee||!n.data("sleeping")&&U&&(n.publish("sleeping"),n.data("sleeping",!0)),e.deferred.resolve()}),n.registerCommand("wake",function(e){var t='{"purpose":"cancel-idle-timer"}';n.data("sleeping")&&U&&(n.publish("waking"),n.data("sleeping",!1),s=c,ke("customNotice","POST",{eventAttributes:ee?JSON.parse(t):t})),!0===e.data.resetIdleState&&ke("customNotice","POST",{eventAttributes:ee?JSON.parse(t):t}),e.deferred.resolve()}),n.registerCommand("verifySession",function(e){var t=void 0,n=void 0;N?we.push(e.deferred):(me?_&&(t=_.sessionID,n=_):(t=l.default.getCookie(j),n=l.default.getCookie(R)),"string"==typeof n&&n.length>0&&(n=JSON.parse(n)),t&&n&&Object.keys(n).length&&!Re()?e.deferred.resolve({sessionActive:!0}):e.deferred.resolve({sessionActive:!1}))}),n.registerCommand("resetPollExceptions",function(e){q=!1,v=0,e.deferred.resolve()}),n.registerCommand("sendCustomNotice",function(e){Ye(),ke("customNotice","POST",{alias:_.alias,secureKey:_.secureKey,userId:_.userId,message:e.data.message||""}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}),n.registerCommand("updateUserData",function(e){Ye(),n.data("userData",a({},n.data("userData"),e.data||{})),U?ke("updateData","POST",{alias:_.alias,secureKey:_.secureKey,userId:_.userId,userData:e.data||{}}).done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)}):e.deferred.resolve(n.data("userData"))}),n.registerCommand("sendTyping",function(e){if(!U)return e.deferred.reject("There is no active chat session"),!1;var t=e.data||{},r=!1,s=ue,i={alias:_.alias,secureKey:_.secureKey,userId:_.userId,transcriptPosition:L};if("boolean"!=typeof t.isTyping&&(t.isTyping=!0),ee)i.message=t.message||ce&&ce.val()||"",s.Interval||(s.Interval=setInterval(function(){ce&&ce.val()!=s.text?(i.message=t.message||ce&&ce.val()||"",r=ke("startTyping","POST",i),s.text=ce.val()):++s.IdleCount==s.IdleLimit&&(clearInterval(s.Interval),s.IdleCount=0,s.Interval=!1,i.message=t.message||ce&&ce.val()||"",r=ke("stopTyping","POST",i))},5e3),r=ke("startTyping","POST",i));else{if(s.Interval)return s.Timer=0,e.deferred.resolve(),!1;Ye(),i.message=t.message||ce&&ce.val()||"",r=ke("startTyping","POST",i),n.publish("clientTypingStarted"),s.Interval=setInterval(function(){s.Timer+=s.TimeInterval,s.Timer>=s.Timeout&&(i.message=t.message||ce&&ce.val()||"",clearInterval(s.Interval),s.Interval=!1,s.Timer=0,r=ke("stopTyping","POST",i),n.publish("clientTypingStopped"))},s.TimeInterval),r.done(function(t){e.deferred.resolve(t)}).fail(function(t){e.deferred.reject(t)})}}),n.registerCommand("getAgents",function(e){e.deferred.resolve({agents:u.default.extend($,{})})}),n.registerCommand("getTranscript",function(e){var t={messages:U?X:G,originalMessages:U?z:V};e.deferred.resolve(t)}),n.registerCommand("getStats",function(e){var t={agents:u.default.extend($,{}),startTime:!1,endTime:!1,duration:!1};X.length>0&&(t.startTime=X[0].timestamp,t.endTime=X[X.length-1].timestamp,t.duration=t.endTime-t.startTime),e.deferred.resolve(t)}),n.registerCommand("registerTypingPreviewInput",function(e){var t=(0,u.default)(e.data.input);!t||"text"!=t[0].type&&"textarea"!=t[0].type?e.deferred.reject("Invalid value provided for the 'input' property. An HTML element reference to a textarea or text input is required."):(ce=t,e.deferred.resolve())}),n.registerCommand("registerPreProcessor",function(e){"function"==typeof e.data.preprocessor?(le.push(e.data.preprocessor),e.deferred.resolve(e.data.preprocessor)):e.deferred.reject("No preprocessor function provided. Type provided was '"+o(e.data.preprocessor)+"'.")}),n.subscribe("GWE.ready",function(){n.command("GWE.getIDs").done(function(e){n.data("userData",a({},n.data("userData"),e))})}),n.subscribe("App.language",function(e){ge=e.data}),n.subscribe("App.data.pageFocus",function(e){oe&&U&&(!1===e.data.value?n.command("sleep"):!0===e.data.value&&Ye())}),n.subscribe("App.data.pageHidden",function(e){oe&&U&&(!1===e.data.value&&n.data("App.pageFocus")?Ye():!0===e.data.value&&n.command("sleep"))}),n.subscribe("WebChat.closed",function(){G=[],V=[],Q=!1}),oe&&U&&(n.data("App.pageFocus")?Ye():n.command("sleep")),qe(),n.command("configure",_genesys.widgets.webchat),n.ready(),n.republish("ready")}var n="";return{init:function(e){(n=e)&&t()}}})}},["./webapp/plugins/cx-webchat-service/controllers/legacy-controller.js"]);